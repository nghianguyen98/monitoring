define(["react","lodash","@grafana/data","@grafana/ui","@emotion/css","@grafana/runtime","moment","app/core/utils/datemath","jquery","app/plugins/sdk","app/core/core_module","app/core/core","app/core/table_model","app/core/utils/kbn","app/core/config","angular"],(function(e,t,r,n,i,a,o,s,u,l,c,p,f,h,d,m){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=76)}([function(t,r){t.exports=e},function(e,r){e.exports=t},,function(e,t,r){"use strict";r.d(t,"x",(function(){return c})),r.d(t,"f",(function(){return p})),r.d(t,"g",(function(){return f})),r.d(t,"c",(function(){return d})),r.d(t,"v",(function(){return m})),r.d(t,"s",(function(){return v})),r.d(t,"m",(function(){return y})),r.d(t,"n",(function(){return b})),r.d(t,"i",(function(){return E})),r.d(t,"a",(function(){return x})),r.d(t,"e",(function(){return T})),r.d(t,"r",(function(){return I})),r.d(t,"q",(function(){return w})),r.d(t,"u",(function(){return A})),r.d(t,"h",(function(){return S})),r.d(t,"w",(function(){return P})),r.d(t,"b",(function(){return O})),r.d(t,"k",(function(){return D})),r.d(t,"t",(function(){return R})),r.d(t,"o",(function(){return _})),r.d(t,"p",(function(){return C})),r.d(t,"d",(function(){return k})),r.d(t,"j",(function(){return F})),r.d(t,"l",(function(){return $}));var n=r(1),i=r.n(n),a=r(11),o=r.n(a),s=r(4),u=r(7),l=r(5),c=/\$(\w+)|\[\[([\s\S]+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::(\w+))?}/g;function p(e,t){for(var r,n,a,o,s,u=t.substring(t.indexOf("[")+1,t.lastIndexOf("]")),l=(r=u,n=[],a=!1,o=!1,s="",i.a.forEach(r,(function(e){'"'===e&&o?s+=e:'"'===e&&a?a=!1:'"'!==e||a?"["!==e||a?"]"!==e||a?","!==e||a||o?s+=e:(n.push(s),s=""):o=!1:o=!0:a=!0})),n.push(s),n),c=l.length;c>=1;c--)e=e.replace("$"+c,l[c-1]);return e}function f(e){return i.a.forEach(e,(function(e){return e.item=e.name,e.name=p(e.item,e.key_),e})),e}var h=/{\$[A-Z0-9_\.]+}/g;function d(e){return h.test(e)}function m(e,t,r){var n=r?e.url:e.name,a=n.match(h);return i.a.forEach(a,(function(a){var o=i.a.filter(t,(function(t){if(t.hostid){if(r){var n=!1;return i.a.forEach(e.hosts,(function(e){e.hostid===t.hostid&&(n=!0)})),n}return t.hostid===e.hostid}return!0})),s=i.a.find(o,{macro:a});if(s&&s.value){var u=s.value,l=new RegExp(function(e){return e=e.replace(/\$/,"\\$")}(a));n=n.replace(l,u)}})),n}function v(e){var t,r=[];i.a.each(function(e){var t;if(function(e){return/^\{.+\}$/.test(e)}(e)){var r=e.match(/\{[^\{\}]*\}|\{\/.*\/\}/g);t=i.a.map(r,(function(e){return i.a.trim(e,"{}")}))}else t=e.split(".");return t}(e),(function(e){"*"===e&&(e="/.*/"),r.push(e)}));var n=i.a.zipObject(["group","host","app","item"],r);switch(4===r.length&&"/.*/"===n.app&&(n.app=""),r.length){case 1:t=u.b.Group;break;case 2:t=u.b.Host;break;case 3:t=u.b.Application;break;case 4:t=u.b.Item}return{queryType:t,group:n.group||"",host:n.host||"",application:n.app||"",item:n.item||""}}var g=/^\/(.*)\/([gmi]*)$/m;function y(e){return g.test(e)}function b(e,t){if(/^\$\w+/.test(e)){var r=i.a.map(t,(function(e){return"$"+e.name}));return i.a.includes(r,e)}return!1}function E(e){var t=e.to.diff(e.from),r=Math.round(t/1e3),n=l.rangeUtil.secondsToHms(t/1e3);return{__range_ms:{text:t,value:t},__range_s:{text:r,value:r},__range:{text:n,value:n},__range_series:{text:s.k,value:s.k}}}function x(e){var t=e.match(g),r=t[1],n=""!==t[2]?t[2]:void 0;return new RegExp(r,n)}function T(e){return e.replace(/[\\^$*+?.()|[\]{}\/]/g,"\\$&")}function I(e){var t=function(e){var t=/(^[\d]+)(y|M|w|d|h|m|s)?/g.exec(e);if(!t||!e||t.length>2&&!t[2])return"";return t[1]+(t.length>2?t[2]:"s")}(e);return t?w(t):0}function w(e){var t=/(^[\d]+)(y|M|w|d|h|m|s)/g.exec(e);return o.a.duration(Number(t[1]),t[2]).valueOf()}function A(e){var t=/^([\+\-]*)([\d]+)(y|M|w|d|h|m|s)/g.exec(e);return"+"===t[1]?0-o.a.duration(Number(t[2]),t[3]).valueOf():o.a.duration(Number(t[2]),t[3]).valueOf()}function S(e){if(e.length){var t="<br><br>Acknowledges:<br><table><tr><td><b>Time</b></td><td><b>User</b></td><td><b>Comments</b></td></tr>";return i.a.each(i.a.map(e,(function(e){return"<tr><td><i>"+o.a.unix(e.clock).format("DD MMM YYYY HH:mm:ss")+"</i></td><td>"+e.alias+" ("+e.name+" "+e.surname+")</td><td>"+e.message+"</td></tr>"})),(function(e){t=t.concat(e)})),t=t.concat("</table>")}return""}function P(e){return function(t){for(var r=0;r<e.length;r++)t=e[r].call(this,t);return t}}function O(e){return e.replace(/\s+/g," ").trim()}function D(e){return!isNaN(parseFloat(e))&&isFinite(e)}function R(e){if(!e)return[];var t=i.a.map(e.split(","),(function(e){return e.trim()}));return t=i.a.map(t,(function(e){var t,r,n=e.split(":");return{tag:null===(t=n[0])||void 0===t?void 0:t.trim(),value:null===(r=n[1])||void 0===r?void 0:r.trim()}}))}function _(e){return e.value?e.tag+": "+e.value:e.tag}function C(e){return e||[]}var N={"%":"percent",b:"decbits",bps:"bps",B:"bytes",Bps:"binBps",uptime:"dtdhms",qps:"qps",iops:"iops",Hz:"hertz",V:"volt",C:"celsius",RPM:"rotrpm",dBm:"dBm"},L=function(){for(var e={},t=0,r=Object(l.getValueFormats)();t<r.length;t++)for(var n=0,i=r[t].submenu;n<i.length;n++){var a=i[n].value;e[a]=a}return e}();function k(e){var t=N[e];return t||(t=L[e]),t}function F(e,t){var r=e.valuemapid,n=null==t?void 0:t.find((function(e){return e.valuemapid===r}));return n?n.mappings.map((function(e,t){return{type:l.MappingType.ValueToText,options:{value:e.value,text:e.newvalue}}})):null}function $(e){return e.fields.length&&e.fields[0].type===l.FieldType.other&&"problems"===e.fields[0].config.custom.type}},function(e,t,r){"use strict";r.d(t,"m",(function(){return n})),r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return a})),r.d(t,"g",(function(){return o})),r.d(t,"f",(function(){return s})),r.d(t,"i",(function(){return u})),r.d(t,"e",(function(){return l})),r.d(t,"j",(function(){return c})),r.d(t,"h",(function(){return p})),r.d(t,"r",(function(){return f})),r.d(t,"q",(function(){return h})),r.d(t,"n",(function(){return d})),r.d(t,"o",(function(){return m})),r.d(t,"p",(function(){return v})),r.d(t,"l",(function(){return g})),r.d(t,"d",(function(){return y})),r.d(t,"k",(function(){return b})),r.d(t,"c",(function(){return E}));var n="alexanderzobnin-zabbix-triggers-panel",i=0,a=1,o="0",s="1",u="2",l="3",c="4",p="5",f=0,h=1,d=2,m=4,v=8,g=[{val:0,text:"Not classified"},{val:1,text:"Information"},{val:2,text:"Warning"},{val:3,text:"Average"},{val:4,text:"High"},{val:5,text:"Disaster"}],y=3600,b="range_series",E=1001},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t,r){"use strict";var n,i;r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return i})),function(e){e.Group="group",e.Host="host",e.Application="application",e.ItemTag="itemTag",e.Item="item",e.ItemValues="itemValues"}(n||(n={})),function(e){e.Problems="problems",e.Recent="recent",e.History="history"}(i||(i={}))},function(e,t){e.exports=i},function(e,t){e.exports=a},,function(e,t){e.exports=o},function(e,t,r){const n=r(26),{MAX_LENGTH:i,MAX_SAFE_INTEGER:a}=r(25),{re:o,t:s}=r(21),u=r(27),{compareIdentifiers:l}=r(32);class c{constructor(e,t){if(t=u(t),e instanceof c){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>i)throw new TypeError(`version is longer than ${i} characters`);n("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?o[s.LOOSE]:o[s.FULL]);if(!r)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>a||this.major<0)throw new TypeError("Invalid major version");if(this.minor>a||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>a||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<a)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version}toString(){return this.version}compare(e){if(n("SemVer.compare",this.version,this.options,e),!(e instanceof c)){if("string"==typeof e&&e===this.version)return 0;e=new c(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof c||(e=new c(e,this.options)),l(this.major,e.major)||l(this.minor,e.minor)||l(this.patch,e.patch)}comparePre(e){if(e instanceof c||(e=new c(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const r=this.prerelease[t],i=e.prerelease[t];if(n("prerelease compare",t,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return-1;if(r!==i)return l(r,i)}while(++t)}compareBuild(e){e instanceof c||(e=new c(e,this.options));let t=0;do{const r=this.build[t],i=e.build[t];if(n("prerelease compare",t,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return-1;if(r!==i)return l(r,i)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)"number"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this}}e.exports=c},function(e,t,r){"use strict";r.d(t,"c",(function(){return u})),r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return c}));var n=r(1),i=r.n(n),a=r(11),o=r.n(a),s=r(3);function u(e,t){try{var r=s.q(t);return Date.now()-1e3*e.timestamp<r}catch(e){return!1}}function l(e,t){var r=t||"DD MMM YYYY HH:mm:ss";return o.a.unix(e).format(r)}var c=function(e){return i.a.find("ABCDEFGHIJKLMNOPQRSTUVWXYZ",(function(t){return i.a.every(e,(function(e){return e.refId!==t}))}))}},function(e,t){e.exports=s},function(e,t){e.exports=u},function(e,t,r){const n=r(12);e.exports=(e,t,r)=>new n(e,r).compare(new n(t,r))},function(e,t,r){class n{constructor(e,t){if(t=a(t),e instanceof n)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new n(e.raw,t);if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter(e=>!d(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&m(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map(e=>e.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(e){e=e.trim();const t=`parseRange:${Object.keys(this.options).join(",")}:${e}`,r=i.get(t);if(r)return r;const n=this.options.loose,a=n?l[c.HYPHENRANGELOOSE]:l[c.HYPHENRANGE];e=e.replace(a,P(this.options.includePrerelease)),s("hyphen replace",e),e=e.replace(l[c.COMPARATORTRIM],p),s("comparator trim",e,l[c.COMPARATORTRIM]),e=(e=(e=e.replace(l[c.TILDETRIM],f)).replace(l[c.CARETTRIM],h)).split(/\s+/).join(" ");const u=n?l[c.COMPARATORLOOSE]:l[c.COMPARATOR],m=e.split(" ").map(e=>g(e,this.options)).join(" ").split(/\s+/).map(e=>S(e,this.options)).filter(this.options.loose?e=>!!e.match(u):()=>!0).map(e=>new o(e,this.options)),v=(m.length,new Map);for(const e of m){if(d(e))return[e];v.set(e.value,e)}v.size>1&&v.has("")&&v.delete("");const y=[...v.values()];return i.set(t,y),y}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Range is required");return this.set.some(r=>v(r,t)&&e.set.some(e=>v(e,t)&&r.every(r=>e.every(e=>r.intersects(e,t)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(O(this.set[t],e,this.options))return!0;return!1}}e.exports=n;const i=new(r(60))({max:1e3}),a=r(27),o=r(29),s=r(26),u=r(12),{re:l,t:c,comparatorTrimReplace:p,tildeTrimReplace:f,caretTrimReplace:h}=r(21),d=e=>"<0.0.0-0"===e.value,m=e=>""===e.value,v=(e,t)=>{let r=!0;const n=e.slice();let i=n.pop();for(;r&&n.length;)r=n.every(e=>i.intersects(e,t)),i=n.pop();return r},g=(e,t)=>(s("comp",e,t),e=x(e,t),s("caret",e),e=b(e,t),s("tildes",e),e=I(e,t),s("xrange",e),e=A(e,t),s("stars",e),e),y=e=>!e||"x"===e.toLowerCase()||"*"===e,b=(e,t)=>e.trim().split(/\s+/).map(e=>E(e,t)).join(" "),E=(e,t)=>{const r=t.loose?l[c.TILDELOOSE]:l[c.TILDE];return e.replace(r,(t,r,n,i,a)=>{let o;return s("tilde",e,t,r,n,i,a),y(r)?o="":y(n)?o=`>=${r}.0.0 <${+r+1}.0.0-0`:y(i)?o=`>=${r}.${n}.0 <${r}.${+n+1}.0-0`:a?(s("replaceTilde pr",a),o=`>=${r}.${n}.${i}-${a} <${r}.${+n+1}.0-0`):o=`>=${r}.${n}.${i} <${r}.${+n+1}.0-0`,s("tilde return",o),o})},x=(e,t)=>e.trim().split(/\s+/).map(e=>T(e,t)).join(" "),T=(e,t)=>{s("caret",e,t);const r=t.loose?l[c.CARETLOOSE]:l[c.CARET],n=t.includePrerelease?"-0":"";return e.replace(r,(t,r,i,a,o)=>{let u;return s("caret",e,t,r,i,a,o),y(r)?u="":y(i)?u=`>=${r}.0.0${n} <${+r+1}.0.0-0`:y(a)?u="0"===r?`>=${r}.${i}.0${n} <${r}.${+i+1}.0-0`:`>=${r}.${i}.0${n} <${+r+1}.0.0-0`:o?(s("replaceCaret pr",o),u="0"===r?"0"===i?`>=${r}.${i}.${a}-${o} <${r}.${i}.${+a+1}-0`:`>=${r}.${i}.${a}-${o} <${r}.${+i+1}.0-0`:`>=${r}.${i}.${a}-${o} <${+r+1}.0.0-0`):(s("no pr"),u="0"===r?"0"===i?`>=${r}.${i}.${a}${n} <${r}.${i}.${+a+1}-0`:`>=${r}.${i}.${a}${n} <${r}.${+i+1}.0-0`:`>=${r}.${i}.${a} <${+r+1}.0.0-0`),s("caret return",u),u})},I=(e,t)=>(s("replaceXRanges",e,t),e.split(/\s+/).map(e=>w(e,t)).join(" ")),w=(e,t)=>{e=e.trim();const r=t.loose?l[c.XRANGELOOSE]:l[c.XRANGE];return e.replace(r,(r,n,i,a,o,u)=>{s("xRange",e,r,n,i,a,o,u);const l=y(i),c=l||y(a),p=c||y(o),f=p;return"="===n&&f&&(n=""),u=t.includePrerelease?"-0":"",l?r=">"===n||"<"===n?"<0.0.0-0":"*":n&&f?(c&&(a=0),o=0,">"===n?(n=">=",c?(i=+i+1,a=0,o=0):(a=+a+1,o=0)):"<="===n&&(n="<",c?i=+i+1:a=+a+1),"<"===n&&(u="-0"),r=`${n+i}.${a}.${o}${u}`):c?r=`>=${i}.0.0${u} <${+i+1}.0.0-0`:p&&(r=`>=${i}.${a}.0${u} <${i}.${+a+1}.0-0`),s("xRange return",r),r})},A=(e,t)=>(s("replaceStars",e,t),e.trim().replace(l[c.STAR],"")),S=(e,t)=>(s("replaceGTE0",e,t),e.trim().replace(l[t.includePrerelease?c.GTE0PRE:c.GTE0],"")),P=e=>(t,r,n,i,a,o,s,u,l,c,p,f,h)=>`${r=y(n)?"":y(i)?`>=${n}.0.0${e?"-0":""}`:y(a)?`>=${n}.${i}.0${e?"-0":""}`:o?">="+r:`>=${r}${e?"-0":""}`} ${u=y(l)?"":y(c)?`<${+l+1}.0.0-0`:y(p)?`<${l}.${+c+1}.0-0`:f?`<=${l}.${c}.${p}-${f}`:e?`<${l}.${c}.${+p+1}-0`:"<="+u}`.trim(),O=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(s(e[r].semver),e[r].semver!==o.ANY&&e[r].semver.prerelease.length>0){const n=e[r].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}return!1}return!0}},function(e,t){e.exports=l},function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return l}));var n=r(1),i=r.n(n),a=r(13),o=r(7),s=function(){return(s=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},u=8;function l(e){var t;if(function(e){return e.targets&&1===e.targets.length&&function(e){var t,r,n,i;return!((null===(t=e.group)||void 0===t?void 0:t.filter)||(null===(r=e.host)||void 0===r?void 0:r.filter)||(null===(n=e.application)||void 0===n?void 0:n.filter)||(null===(i=e.trigger)||void 0===i?void 0:i.filter)||e.queryType)}(e.targets[0])}(e))return e;if(function(e){return!e.datasource&&!e.datasources&&!e.triggers&&(t=e.targets,!t||i.a.isArray(t)&&(0===t.length||1===t.length&&i.a.isEmpty(t[0])));var t}(e))return delete e.targets,e;var r=function(e){return e.schemaVersion||1}(e);if(r<2&&(e.datasources=[e.datasource],e.targets={},e.targets[e.datasources[0]]=e.triggers,delete e.triggers,delete e.datasource),r<3&&(delete e.lastChangeField,delete e.infoField,delete e.scroll,delete e.hideHostsInMaintenance),r<5&&e.targets&&!i.a.isEmpty(e.targets)&&i.a.each(e.targets,(function(e){var t;i.a.defaultsDeep(e,{group:{filter:""},host:{filter:""},application:{filter:""},trigger:{filter:""},tags:{filter:""},proxy:{filter:""},refId:Object(a.b)(t)})})),r<6&&e.showEvents&&"1"===e.showEvents.value&&(e.showEvents.value=1),r<7){var n=[];for(var o in e.targets){f(v=e.targets[o])||h(v,o)||n.push(s(s({},v),{datasource:o}))}for(var u=0,l=n;u<l.length;u++){(v=l[u]).refId||(v.refId=Object(a.b)(n))}e.targets=n,delete e.datasources}if(r<8){1===e.targets.length?e.targets[0].datasource&&(e.datasource=e.targets[0].datasource,delete e.targets[0].datasource):e.targets.length>1&&(e.datasource="-- Mixed --");for(var d=0,m=e.targets;d<m.length;d++){var v;(v=m[d]).queryType=5,v.showProblems=p(e),v.options=c(e),i.a.defaults(v.options,{hostsInMaintenance:!0}),i.a.defaults(v,{tags:{filter:""}})}e.sortProblems="priority"===(null===(t=e.sortTriggersBy)||void 0===t?void 0:t.value)?"priority":"lastchange",delete e.showEvents,delete e.showTriggers,delete e.hostsInMaintenance,delete e.sortTriggersBy}return e}function c(e){var t,r=2;"acknowledged"===e.showTriggers?r=1:"unacknowledged"===e.showTriggers&&(r=0);var n=1001;return e.limit&&100!==e.limit&&(n=e.limit),{hostsInMaintenance:e.hostsInMaintenance,sortProblems:"priority"===(null===(t=e.sortTriggersBy)||void 0===t?void 0:t.value)?"priority":"default",minSeverity:0,acknowledged:r,limit:n}}function p(e){var t,r,n,i;return 1===(null===(t=e.showEvents)||void 0===t?void 0:t.value)?o.a.Problems:0===(null===(r=e.showEvents)||void 0===r?void 0:r.value)||(null===(i=null===(n=e.showEvents)||void 0===n?void 0:n.value)||void 0===i?void 0:i.length)>1?o.a.History:o.a.Problems}function f(e){return!e||!(e.group&&e.host&&e.application&&e.trigger)}function h(e,t){return e&&"A"===e.refId&&"0"===t}},function(e,t,r){const n=r(21);e.exports={re:n.re,src:n.src,tokens:n.t,SEMVER_SPEC_VERSION:r(25).SEMVER_SPEC_VERSION,SemVer:r(12),compareIdentifiers:r(32).compareIdentifiers,rcompareIdentifiers:r(32).rcompareIdentifiers,parse:r(22),valid:r(47),clean:r(48),inc:r(49),diff:r(50),major:r(51),minor:r(52),patch:r(53),prerelease:r(54),compare:r(16),rcompare:r(55),compareLoose:r(56),compareBuild:r(34),sort:r(57),rsort:r(58),gt:r(28),lt:r(35),eq:r(33),neq:r(42),gte:r(36),lte:r(37),cmp:r(43),coerce:r(59),Comparator:r(29),Range:r(17),satisfies:r(30),toComparators:r(63),maxSatisfying:r(64),minSatisfying:r(65),minVersion:r(66),validRange:r(67),outside:r(38),gtr:r(68),ltr:r(69),intersects:r(70),simplifyRange:r(71),subset:r(72)}},function(e,t,r){const{MAX_SAFE_COMPONENT_LENGTH:n}=r(25),i=r(26),a=(t=e.exports={}).re=[],o=t.src=[],s=t.t={};let u=0;const l=(e,t,r)=>{const n=u++;i(n,t),s[e]=n,o[n]=t,a[n]=new RegExp(t,r?"g":void 0)};l("NUMERICIDENTIFIER","0|[1-9]\\d*"),l("NUMERICIDENTIFIERLOOSE","[0-9]+"),l("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),l("MAINVERSION",`(${o[s.NUMERICIDENTIFIER]})\\.(${o[s.NUMERICIDENTIFIER]})\\.(${o[s.NUMERICIDENTIFIER]})`),l("MAINVERSIONLOOSE",`(${o[s.NUMERICIDENTIFIERLOOSE]})\\.(${o[s.NUMERICIDENTIFIERLOOSE]})\\.(${o[s.NUMERICIDENTIFIERLOOSE]})`),l("PRERELEASEIDENTIFIER",`(?:${o[s.NUMERICIDENTIFIER]}|${o[s.NONNUMERICIDENTIFIER]})`),l("PRERELEASEIDENTIFIERLOOSE",`(?:${o[s.NUMERICIDENTIFIERLOOSE]}|${o[s.NONNUMERICIDENTIFIER]})`),l("PRERELEASE",`(?:-(${o[s.PRERELEASEIDENTIFIER]}(?:\\.${o[s.PRERELEASEIDENTIFIER]})*))`),l("PRERELEASELOOSE",`(?:-?(${o[s.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${o[s.PRERELEASEIDENTIFIERLOOSE]})*))`),l("BUILDIDENTIFIER","[0-9A-Za-z-]+"),l("BUILD",`(?:\\+(${o[s.BUILDIDENTIFIER]}(?:\\.${o[s.BUILDIDENTIFIER]})*))`),l("FULLPLAIN",`v?${o[s.MAINVERSION]}${o[s.PRERELEASE]}?${o[s.BUILD]}?`),l("FULL",`^${o[s.FULLPLAIN]}$`),l("LOOSEPLAIN",`[v=\\s]*${o[s.MAINVERSIONLOOSE]}${o[s.PRERELEASELOOSE]}?${o[s.BUILD]}?`),l("LOOSE",`^${o[s.LOOSEPLAIN]}$`),l("GTLT","((?:<|>)?=?)"),l("XRANGEIDENTIFIERLOOSE",o[s.NUMERICIDENTIFIERLOOSE]+"|x|X|\\*"),l("XRANGEIDENTIFIER",o[s.NUMERICIDENTIFIER]+"|x|X|\\*"),l("XRANGEPLAIN",`[v=\\s]*(${o[s.XRANGEIDENTIFIER]})(?:\\.(${o[s.XRANGEIDENTIFIER]})(?:\\.(${o[s.XRANGEIDENTIFIER]})(?:${o[s.PRERELEASE]})?${o[s.BUILD]}?)?)?`),l("XRANGEPLAINLOOSE",`[v=\\s]*(${o[s.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[s.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[s.XRANGEIDENTIFIERLOOSE]})(?:${o[s.PRERELEASELOOSE]})?${o[s.BUILD]}?)?)?`),l("XRANGE",`^${o[s.GTLT]}\\s*${o[s.XRANGEPLAIN]}$`),l("XRANGELOOSE",`^${o[s.GTLT]}\\s*${o[s.XRANGEPLAINLOOSE]}$`),l("COERCE",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?(?:$|[^\\d])`),l("COERCERTL",o[s.COERCE],!0),l("LONETILDE","(?:~>?)"),l("TILDETRIM",`(\\s*)${o[s.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",l("TILDE",`^${o[s.LONETILDE]}${o[s.XRANGEPLAIN]}$`),l("TILDELOOSE",`^${o[s.LONETILDE]}${o[s.XRANGEPLAINLOOSE]}$`),l("LONECARET","(?:\\^)"),l("CARETTRIM",`(\\s*)${o[s.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",l("CARET",`^${o[s.LONECARET]}${o[s.XRANGEPLAIN]}$`),l("CARETLOOSE",`^${o[s.LONECARET]}${o[s.XRANGEPLAINLOOSE]}$`),l("COMPARATORLOOSE",`^${o[s.GTLT]}\\s*(${o[s.LOOSEPLAIN]})$|^$`),l("COMPARATOR",`^${o[s.GTLT]}\\s*(${o[s.FULLPLAIN]})$|^$`),l("COMPARATORTRIM",`(\\s*)${o[s.GTLT]}\\s*(${o[s.LOOSEPLAIN]}|${o[s.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",l("HYPHENRANGE",`^\\s*(${o[s.XRANGEPLAIN]})\\s+-\\s+(${o[s.XRANGEPLAIN]})\\s*$`),l("HYPHENRANGELOOSE",`^\\s*(${o[s.XRANGEPLAINLOOSE]})\\s+-\\s+(${o[s.XRANGEPLAINLOOSE]})\\s*$`),l("STAR","(<|>)?=?\\s*\\*"),l("GTE0","^\\s*>=\\s*0.0.0\\s*$"),l("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")},function(e,t,r){const{MAX_LENGTH:n}=r(25),{re:i,t:a}=r(21),o=r(12),s=r(27);e.exports=(e,t)=>{if(t=s(t),e instanceof o)return e;if("string"!=typeof e)return null;if(e.length>n)return null;if(!(t.loose?i[a.LOOSE]:i[a.FULL]).test(e))return null;try{return new o(e,t)}catch(e){return null}}},,,function(e,t){const r=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:r,MAX_SAFE_COMPONENT_LENGTH:16}},function(e,t){const r="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=r},function(e,t){const r=["includePrerelease","loose","rtl"];e.exports=e=>e?"object"!=typeof e?{loose:!0}:r.filter(t=>e[t]).reduce((e,t)=>(e[t]=!0,e),{}):{}},function(e,t,r){const n=r(16);e.exports=(e,t,r)=>n(e,t,r)>0},function(e,t,r){const n=Symbol("SemVer ANY");class i{static get ANY(){return n}constructor(e,t){if(t=a(t),e instanceof i){if(e.loose===!!t.loose)return e;e=e.value}l("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===n?this.value="":this.value=this.operator+this.semver.version,l("comp",this)}parse(e){const t=this.options.loose?o[s.COMPARATORLOOSE]:o[s.COMPARATOR],r=e.match(t);if(!r)throw new TypeError("Invalid comparator: "+e);this.operator=void 0!==r[1]?r[1]:"","="===this.operator&&(this.operator=""),r[2]?this.semver=new c(r[2],this.options.loose):this.semver=n}toString(){return this.value}test(e){if(l("Comparator.test",e,this.options.loose),this.semver===n||e===n)return!0;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}return u(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof i))throw new TypeError("a Comparator is required");if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return""===this.value||new p(e.value,t).test(this.value);if(""===e.operator)return""===e.value||new p(this.value,t).test(e.semver);const r=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),n=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),a=this.semver.version===e.semver.version,o=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),s=u(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),l=u(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return r||n||a&&o||s||l}}e.exports=i;const a=r(27),{re:o,t:s}=r(21),u=r(43),l=r(26),c=r(12),p=r(17)},function(e,t,r){const n=r(17);e.exports=(e,t,r)=>{try{t=new n(t,r)}catch(e){return!1}return t.test(e)}},function(e,t){e.exports=c},function(e,t){const r=/^[0-9]+$/,n=(e,t)=>{const n=r.test(e),i=r.test(t);return n&&i&&(e=+e,t=+t),e===t?0:n&&!i?-1:i&&!n?1:e<t?-1:1};e.exports={compareIdentifiers:n,rcompareIdentifiers:(e,t)=>n(t,e)}},function(e,t,r){const n=r(16);e.exports=(e,t,r)=>0===n(e,t,r)},function(e,t,r){const n=r(12);e.exports=(e,t,r)=>{const i=new n(e,r),a=new n(t,r);return i.compare(a)||i.compareBuild(a)}},function(e,t,r){const n=r(16);e.exports=(e,t,r)=>n(e,t,r)<0},function(e,t,r){const n=r(16);e.exports=(e,t,r)=>n(e,t,r)>=0},function(e,t,r){const n=r(16);e.exports=(e,t,r)=>n(e,t,r)<=0},function(e,t,r){const n=r(12),i=r(29),{ANY:a}=i,o=r(17),s=r(30),u=r(28),l=r(35),c=r(37),p=r(36);e.exports=(e,t,r,f)=>{let h,d,m,v,g;switch(e=new n(e,f),t=new o(t,f),r){case">":h=u,d=c,m=l,v=">",g=">=";break;case"<":h=l,d=p,m=u,v="<",g="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(e,t,f))return!1;for(let r=0;r<t.set.length;++r){const n=t.set[r];let o=null,s=null;if(n.forEach(e=>{e.semver===a&&(e=new i(">=0.0.0")),o=o||e,s=s||e,h(e.semver,o.semver,f)?o=e:m(e.semver,s.semver,f)&&(s=e)}),o.operator===v||o.operator===g)return!1;if((!s.operator||s.operator===v)&&d(e,s.semver))return!1;if(s.operator===g&&m(e,s.semver))return!1}return!0}},function(e,t){e.exports=p},function(e,t){e.exports=f},function(e,t){e.exports=h},function(e,t,r){const n=r(16);e.exports=(e,t,r)=>0!==n(e,t,r)},function(e,t,r){const n=r(33),i=r(42),a=r(28),o=r(36),s=r(35),u=r(37);e.exports=(e,t,r,l)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return n(e,r,l);case"!=":return i(e,r,l);case">":return a(e,r,l);case">=":return o(e,r,l);case"<":return s(e,r,l);case"<=":return u(e,r,l);default:throw new TypeError("Invalid operator: "+t)}}},function(e,t){e.exports=d},function(e,t){e.exports=m},,function(e,t,r){const n=r(22);e.exports=(e,t)=>{const r=n(e,t);return r?r.version:null}},function(e,t,r){const n=r(22);e.exports=(e,t)=>{const r=n(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null}},function(e,t,r){const n=r(12);e.exports=(e,t,r,i)=>{"string"==typeof r&&(i=r,r=void 0);try{return new n(e,r).inc(t,i).version}catch(e){return null}}},function(e,t,r){const n=r(22),i=r(33);e.exports=(e,t)=>{if(i(e,t))return null;{const r=n(e),i=n(t),a=r.prerelease.length||i.prerelease.length,o=a?"pre":"",s=a?"prerelease":"";for(const e in r)if(("major"===e||"minor"===e||"patch"===e)&&r[e]!==i[e])return o+e;return s}}},function(e,t,r){const n=r(12);e.exports=(e,t)=>new n(e,t).major},function(e,t,r){const n=r(12);e.exports=(e,t)=>new n(e,t).minor},function(e,t,r){const n=r(12);e.exports=(e,t)=>new n(e,t).patch},function(e,t,r){const n=r(22);e.exports=(e,t)=>{const r=n(e,t);return r&&r.prerelease.length?r.prerelease:null}},function(e,t,r){const n=r(16);e.exports=(e,t,r)=>n(t,e,r)},function(e,t,r){const n=r(16);e.exports=(e,t)=>n(e,t,!0)},function(e,t,r){const n=r(34);e.exports=(e,t)=>e.sort((e,r)=>n(e,r,t))},function(e,t,r){const n=r(34);e.exports=(e,t)=>e.sort((e,r)=>n(r,e,t))},function(e,t,r){const n=r(12),i=r(22),{re:a,t:o}=r(21);e.exports=(e,t)=>{if(e instanceof n)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){let t;for(;(t=a[o.COERCERTL].exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&t.index+t[0].length===r.index+r[0].length||(r=t),a[o.COERCERTL].lastIndex=t.index+t[1].length+t[2].length;a[o.COERCERTL].lastIndex=-1}else r=e.match(a[o.COERCE]);return null===r?null:i(`${r[2]}.${r[3]||"0"}.${r[4]||"0"}`,t)}},function(e,t,r){"use strict";const n=r(61),i=Symbol("max"),a=Symbol("length"),o=Symbol("lengthCalculator"),s=Symbol("allowStale"),u=Symbol("maxAge"),l=Symbol("dispose"),c=Symbol("noDisposeOnSet"),p=Symbol("lruList"),f=Symbol("cache"),h=Symbol("updateAgeOnGet"),d=()=>1;const m=(e,t,r)=>{const n=e[f].get(t);if(n){const t=n.value;if(v(e,t)){if(y(e,n),!e[s])return}else r&&(e[h]&&(n.value.now=Date.now()),e[p].unshiftNode(n));return t.value}},v=(e,t)=>{if(!t||!t.maxAge&&!e[u])return!1;const r=Date.now()-t.now;return t.maxAge?r>t.maxAge:e[u]&&r>e[u]},g=e=>{if(e[a]>e[i])for(let t=e[p].tail;e[a]>e[i]&&null!==t;){const r=t.prev;y(e,t),t=r}},y=(e,t)=>{if(t){const r=t.value;e[l]&&e[l](r.key,r.value),e[a]-=r.length,e[f].delete(r.key),e[p].removeNode(t)}};class b{constructor(e,t,r,n,i){this.key=e,this.value=t,this.length=r,this.now=n,this.maxAge=i||0}}const E=(e,t,r,n)=>{let i=r.value;v(e,i)&&(y(e,r),e[s]||(i=void 0)),i&&t.call(n,i.value,i.key,e)};e.exports=class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[i]=e.max||1/0;const t=e.length||d;if(this[o]="function"!=typeof t?d:t,this[s]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[u]=e.maxAge||0,this[l]=e.dispose,this[c]=e.noDisposeOnSet||!1,this[h]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[i]=e||1/0,g(this)}get max(){return this[i]}set allowStale(e){this[s]=!!e}get allowStale(){return this[s]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[u]=e,g(this)}get maxAge(){return this[u]}set lengthCalculator(e){"function"!=typeof e&&(e=d),e!==this[o]&&(this[o]=e,this[a]=0,this[p].forEach(e=>{e.length=this[o](e.value,e.key),this[a]+=e.length})),g(this)}get lengthCalculator(){return this[o]}get length(){return this[a]}get itemCount(){return this[p].length}rforEach(e,t){t=t||this;for(let r=this[p].tail;null!==r;){const n=r.prev;E(this,e,r,t),r=n}}forEach(e,t){t=t||this;for(let r=this[p].head;null!==r;){const n=r.next;E(this,e,r,t),r=n}}keys(){return this[p].toArray().map(e=>e.key)}values(){return this[p].toArray().map(e=>e.value)}reset(){this[l]&&this[p]&&this[p].length&&this[p].forEach(e=>this[l](e.key,e.value)),this[f]=new Map,this[p]=new n,this[a]=0}dump(){return this[p].map(e=>!v(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[p]}set(e,t,r){if((r=r||this[u])&&"number"!=typeof r)throw new TypeError("maxAge must be a number");const n=r?Date.now():0,s=this[o](t,e);if(this[f].has(e)){if(s>this[i])return y(this,this[f].get(e)),!1;const o=this[f].get(e).value;return this[l]&&(this[c]||this[l](e,o.value)),o.now=n,o.maxAge=r,o.value=t,this[a]+=s-o.length,o.length=s,this.get(e),g(this),!0}const h=new b(e,t,s,n,r);return h.length>this[i]?(this[l]&&this[l](e,t),!1):(this[a]+=h.length,this[p].unshift(h),this[f].set(e,this[p].head),g(this),!0)}has(e){if(!this[f].has(e))return!1;const t=this[f].get(e).value;return!v(this,t)}get(e){return m(this,e,!0)}peek(e){return m(this,e,!1)}pop(){const e=this[p].tail;return e?(y(this,e),e.value):null}del(e){y(this,this[f].get(e))}load(e){this.reset();const t=Date.now();for(let r=e.length-1;r>=0;r--){const n=e[r],i=n.e||0;if(0===i)this.set(n.k,n.v);else{const e=i-t;e>0&&this.set(n.k,n.v,e)}}}prune(){this[f].forEach((e,t)=>m(this,t,!1))}}},function(e,t,r){"use strict";function n(e){var t=this;if(t instanceof n||(t=new n),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach((function(e){t.push(e)}));else if(arguments.length>0)for(var r=0,i=arguments.length;r<i;r++)t.push(arguments[r]);return t}function i(e,t,r){var n=t===e.head?new s(r,null,t,e):new s(r,t,t.next,e);return null===n.next&&(e.tail=n),null===n.prev&&(e.head=n),e.length++,n}function a(e,t){e.tail=new s(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function o(e,t){e.head=new s(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function s(e,t,r,n){if(!(this instanceof s))return new s(e,t,r,n);this.list=n,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}e.exports=n,n.Node=s,n.create=n,n.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,r=e.prev;return t&&(t.prev=r),r&&(r.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=r),e.list.length--,e.next=null,e.prev=null,e.list=null,t},n.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},n.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},n.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)a(this,arguments[e]);return this.length},n.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)o(this,arguments[e]);return this.length},n.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},n.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},n.prototype.forEach=function(e,t){t=t||this;for(var r=this.head,n=0;null!==r;n++)e.call(t,r.value,n,this),r=r.next},n.prototype.forEachReverse=function(e,t){t=t||this;for(var r=this.tail,n=this.length-1;null!==r;n--)e.call(t,r.value,n,this),r=r.prev},n.prototype.get=function(e){for(var t=0,r=this.head;null!==r&&t<e;t++)r=r.next;if(t===e&&null!==r)return r.value},n.prototype.getReverse=function(e){for(var t=0,r=this.tail;null!==r&&t<e;t++)r=r.prev;if(t===e&&null!==r)return r.value},n.prototype.map=function(e,t){t=t||this;for(var r=new n,i=this.head;null!==i;)r.push(e.call(t,i.value,this)),i=i.next;return r},n.prototype.mapReverse=function(e,t){t=t||this;for(var r=new n,i=this.tail;null!==i;)r.push(e.call(t,i.value,this)),i=i.prev;return r},n.prototype.reduce=function(e,t){var r,n=this.head;if(arguments.length>1)r=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");n=this.head.next,r=this.head.value}for(var i=0;null!==n;i++)r=e(r,n.value,i),n=n.next;return r},n.prototype.reduceReverse=function(e,t){var r,n=this.tail;if(arguments.length>1)r=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");n=this.tail.prev,r=this.tail.value}for(var i=this.length-1;null!==n;i--)r=e(r,n.value,i),n=n.prev;return r},n.prototype.toArray=function(){for(var e=new Array(this.length),t=0,r=this.head;null!==r;t++)e[t]=r.value,r=r.next;return e},n.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,r=this.tail;null!==r;t++)e[t]=r.value,r=r.prev;return e},n.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new n;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=0,a=this.head;null!==a&&i<e;i++)a=a.next;for(;null!==a&&i<t;i++,a=a.next)r.push(a.value);return r},n.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new n;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=this.length,a=this.tail;null!==a&&i>t;i--)a=a.prev;for(;null!==a&&i>e;i--,a=a.prev)r.push(a.value);return r},n.prototype.splice=function(e,t,...r){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var n=0,a=this.head;null!==a&&n<e;n++)a=a.next;var o=[];for(n=0;a&&n<t;n++)o.push(a.value),a=this.removeNode(a);null===a&&(a=this.tail),a!==this.head&&a!==this.tail&&(a=a.prev);for(n=0;n<r.length;n++)a=i(this,a,r[n]);return o},n.prototype.reverse=function(){for(var e=this.head,t=this.tail,r=e;null!==r;r=r.prev){var n=r.prev;r.prev=r.next,r.next=n}return this.head=t,this.tail=e,this};try{r(62)(n)}catch(e){}},function(e,t,r){"use strict";e.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}},function(e,t,r){const n=r(17);e.exports=(e,t)=>new n(e,t).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" "))},function(e,t,r){const n=r(12),i=r(17);e.exports=(e,t,r)=>{let a=null,o=null,s=null;try{s=new i(t,r)}catch(e){return null}return e.forEach(e=>{s.test(e)&&(a&&-1!==o.compare(e)||(a=e,o=new n(a,r)))}),a}},function(e,t,r){const n=r(12),i=r(17);e.exports=(e,t,r)=>{let a=null,o=null,s=null;try{s=new i(t,r)}catch(e){return null}return e.forEach(e=>{s.test(e)&&(a&&1!==o.compare(e)||(a=e,o=new n(a,r)))}),a}},function(e,t,r){const n=r(12),i=r(17),a=r(28);e.exports=(e,t)=>{e=new i(e,t);let r=new n("0.0.0");if(e.test(r))return r;if(r=new n("0.0.0-0"),e.test(r))return r;r=null;for(let t=0;t<e.set.length;++t){const i=e.set[t];let o=null;i.forEach(e=>{const t=new n(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":o&&!a(t,o)||(o=t);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+e.operator)}}),!o||r&&!a(r,o)||(r=o)}return r&&e.test(r)?r:null}},function(e,t,r){const n=r(17);e.exports=(e,t)=>{try{return new n(e,t).range||"*"}catch(e){return null}}},function(e,t,r){const n=r(38);e.exports=(e,t,r)=>n(e,t,">",r)},function(e,t,r){const n=r(38);e.exports=(e,t,r)=>n(e,t,"<",r)},function(e,t,r){const n=r(17);e.exports=(e,t,r)=>(e=new n(e,r),t=new n(t,r),e.intersects(t))},function(e,t,r){const n=r(30),i=r(16);e.exports=(e,t,r)=>{const a=[];let o=null,s=null;const u=e.sort((e,t)=>i(e,t,r));for(const e of u){n(e,t,r)?(s=e,o||(o=e)):(s&&a.push([o,s]),s=null,o=null)}o&&a.push([o,null]);const l=[];for(const[e,t]of a)e===t?l.push(e):t||e!==u[0]?t?e===u[0]?l.push("<="+t):l.push(`${e} - ${t}`):l.push(">="+e):l.push("*");const c=l.join(" || "),p="string"==typeof t.raw?t.raw:String(t);return c.length<p.length?c:t}},function(e,t,r){const n=r(17),{ANY:i}=r(29),a=r(30),o=r(16),s=(e,t,r)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===i)return 1===t.length&&t[0].semver===i;const n=new Set;let s,c,p,f,h,d,m;for(const t of e)">"===t.operator||">="===t.operator?s=u(s,t,r):"<"===t.operator||"<="===t.operator?c=l(c,t,r):n.add(t.semver);if(n.size>1)return null;if(s&&c){if(p=o(s.semver,c.semver,r),p>0)return null;if(0===p&&(">="!==s.operator||"<="!==c.operator))return null}for(const e of n){if(s&&!a(e,String(s),r))return null;if(c&&!a(e,String(c),r))return null;for(const n of t)if(!a(e,String(n),r))return!1;return!0}for(const e of t){if(m=m||">"===e.operator||">="===e.operator,d=d||"<"===e.operator||"<="===e.operator,s)if(">"===e.operator||">="===e.operator){if(f=u(s,e,r),f===e&&f!==s)return!1}else if(">="===s.operator&&!a(s.semver,String(e),r))return!1;if(c)if("<"===e.operator||"<="===e.operator){if(h=l(c,e,r),h===e&&h!==c)return!1}else if("<="===c.operator&&!a(c.semver,String(e),r))return!1;if(!e.operator&&(c||s)&&0!==p)return!1}return!(s&&d&&!c&&0!==p)&&!(c&&m&&!s&&0!==p)},u=(e,t,r)=>{if(!e)return t;const n=o(e.semver,t.semver,r);return n>0?e:n<0||">"===t.operator&&">="===e.operator?t:e},l=(e,t,r)=>{if(!e)return t;const n=o(e.semver,t.semver,r);return n<0?e:n>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,r)=>{if(e===t)return!0;e=new n(e,r),t=new n(t,r);let i=!1;e:for(const n of e.set){for(const e of t.set){const t=s(n,e,r);if(i=i||null!==t,t)continue e}if(i)return!1}return!0}},,,,function(e,t,r){"use strict";r.r(t);var n=r(5),i=r(9),a=r(1),o=r.n(a),s=r(44),u=r.n(s),l=r(39),c=r(14),p=r(3),f=r(4);function h(e){return e.resultFormat=e.resultFormat||"time_series",function(e){return(!e.mode||0===e.mode||2===e.mode)&&!(!(e.hostFilter||e.itemFilter||e.downsampleFunction||e.host&&e.host.host)||void 0!==e.item.filter||void 0!==e.host.filter)}(e=function(e){e.group&&Array.isArray(e.group)&&(e.group={filter:""});return e}(e))?function(e){return e.group.filter="*"===e.group.name?"/.*/":e.group.name,e.host.filter="*"===e.host.name?d(e.hostFilter):e.host.name,e.application.filter="*"===e.application.name?"":e.application.name,e.item.filter="All"===e.item.name?d(e.itemFilter):e.item.name,e}(e):(function(e){if(e.functions)for(var t=0,r=e.functions;t<r.length;t++){var n=r[t];n.def&&"percentil"===n.def.name&&(n.def.name="percentile")}}(e),function(e){var t;void 0===e.queryType&&("Metrics"===e.mode?e.queryType=f.g:void 0!==e.mode&&(e.queryType=e.mode,delete e.mode)),"number"==typeof e.queryType&&(e.queryType=null===(t=e.queryType)||void 0===t?void 0:t.toString())}(e),function(e){e.queryType!==f.f||e.slaInterval||(e.slaInterval="none")}(e),function(e){var t;"priority"===(null===(t=e.options)||void 0===t?void 0:t.sortProblems)&&(e.options.sortProblems="severity")}(e),function(e){var t,r;e.itemTag||(e.itemTag={filter:""},(null===(t=e.application)||void 0===t?void 0:t.filter)&&(e.itemTag.filter="Application: "+(null===(r=e.application)||void 0===r?void 0:r.filter)))}(e),e)}function d(e){return e?"/"+e+"/":"/.*/"}function m(e){if(e||(e={}),!function(e){if(e.dbConnection&&!o.a.isEmpty(e.dbConnection))return!0;if(e.schema&&e.schema<3)return!0;return!1}(e))return e;var t=e.schema||1;if(e.schema=3,t<2){var r=e.dbConnection||{};e.dbConnectionEnable=r.enable||!1,e.dbConnectionDatasourceId=r.datasourceId||null,delete e.dbConnection}return t<3&&(e.timeout=""===e.timeout?null:Number(e.timeout)),e}var v=[],g={Transform:[],Aggregate:[],Filter:[],Trends:[],Time:[],Alias:[],Special:[]};function y(e){e.params=e.params||[],e.defaultParams=e.defaultParams||[],e.category&&g[e.category].push(e),v[e.name]=e,v[e.shortName||e.name]=e}y({name:"groupBy",category:"Transform",params:[{name:"interval",type:"string"},{name:"function",type:"string",options:["avg","min","max","sum","count","median","first","last"]}],defaultParams:["1m","avg"]}),y({name:"scale",category:"Transform",params:[{name:"factor",type:"float",options:[100,.01,10,-1]}],defaultParams:[100]}),y({name:"offset",category:"Transform",params:[{name:"delta",type:"float",options:[-100,100]}],defaultParams:[100]}),y({name:"delta",category:"Transform",params:[],defaultParams:[]}),y({name:"rate",category:"Transform",params:[],defaultParams:[]}),y({name:"movingAverage",category:"Transform",params:[{name:"factor",type:"int",options:[6,10,60,100,600]}],defaultParams:[10]}),y({name:"exponentialMovingAverage",category:"Transform",params:[{name:"smoothing",type:"float",options:[6,10,60,100,600]}],defaultParams:[.2]}),y({name:"percentile",category:"Transform",params:[{name:"interval",type:"string"},{name:"percent",type:"float",options:[25,50,75,90,95,99,99.9]}],defaultParams:["1m",95]}),y({name:"removeAboveValue",category:"Transform",params:[{name:"number",type:"float"}],defaultParams:[0]}),y({name:"removeBelowValue",category:"Transform",params:[{name:"number",type:"float"}],defaultParams:[0]}),y({name:"transformNull",category:"Transform",params:[{name:"number",type:"float"}],defaultParams:[0]}),y({name:"aggregateBy",category:"Aggregate",params:[{name:"interval",type:"string"},{name:"function",type:"string",options:["avg","min","max","sum","count","median","first","last"]}],defaultParams:["1m","avg"]}),y({name:"sumSeries",category:"Aggregate",params:[],defaultParams:[]}),y({name:"percentileAgg",category:"Aggregate",params:[{name:"interval",type:"string"},{name:"percent",type:"float",options:[25,50,75,90,95,99,99.9]}],defaultParams:["1m",95]}),y({name:"top",category:"Filter",params:[{name:"number",type:"int"},{name:"value",type:"string",options:["avg","min","max","sum","count","median","first","last"]}],defaultParams:[5,"avg"]}),y({name:"bottom",category:"Filter",params:[{name:"number",type:"int"},{name:"value",type:"string",options:["avg","min","max","sum","count","median","first","last"]}],defaultParams:[5,"avg"]}),y({name:"sortSeries",category:"Filter",params:[{name:"direction",type:"string",options:["asc","desc"]}],defaultParams:["asc"]}),y({name:"trendValue",category:"Trends",params:[{name:"type",type:"string",options:["avg","min","max","sum","count"]}],defaultParams:["avg"]}),y({name:"timeShift",category:"Time",params:[{name:"interval",type:"string",options:["24h","7d","1M","+24h","-24h"]}],defaultParams:["24h"]}),y({name:"setAlias",category:"Alias",params:[{name:"alias",type:"string"}],defaultParams:[]}),y({name:"setAliasByRegex",category:"Alias",params:[{name:"aliasByRegex",type:"string"}],defaultParams:[]}),y({name:"replaceAlias",category:"Alias",params:[{name:"regexp",type:"string"},{name:"newAlias",type:"string"}],defaultParams:["/(.*)/","$1"]}),y({name:"consolidateBy",category:"Special",params:[{name:"type",type:"string",options:["avg","min","max","sum","count"]}],defaultParams:["avg"]}),o.a.each(g,(function(e,t){g[t]=o.a.sortBy(e,"name")}));var b=function(){function e(e,t){this.def=e,t?this.params=t:(this.params=[],this.params=e.defaultParams.slice(0)),this.updateText()}return e.prototype.bindFunction=function(e){var t=e[this.def.name];if(t){for(var r=t,n=void 0,i=0;i<this.params.length;i++)n=this.params[i],"int"!==this.def.params[i].type&&"float"!==this.def.params[i].type||(n=Number(n)),r=o.a.partial(r,n);return r}throw{message:"Method not found "+this.def.name}},e.prototype.render=function(e){var t=this,r=this.def.name+"(",n=o.a.map(this.params,(function(e,r){var n=t.def.params[r].type;return"int"===n||"float"===n||"value_or_series"===n||"boolean"===n||"int_or_interval"===n&&Object(p.k)(e)?e:"'"+e+"'"}));return e&&n.unshift(e),r+n.join(", ")+")"},e.prototype._hasMultipleParamsInString=function(e,t){return-1!==e.indexOf(",")&&(this.def.params[t+1]&&this.def.params[t+1].optional)},e.prototype.updateParam=function(e,t){var r=this;this._hasMultipleParamsInString(e,t)?o.a.each(e.split(","),(function(e,t){r.updateParam(e.trim(),t)})):(""===e&&this.def.params[t].optional?this.params.splice(t,1):this.params[t]=e,this.updateText())},e.prototype.updateText=function(){if(0!==this.params.length){var e=this.def.name+"(";e+=this.params.join(", "),e+=")",this.text=e}else this.text=this.def.name+"()"},e}();function E(e,t){if(o.a.isString(e)){if(!v[e])throw{message:"Method not found "+name};e=v[e]}return new b(e,t)}function x(){return g}function T(e,t){return new RegExp(t).exec(e)[0]}var I={timeShift:function(e,t){var r=p.u(e)/1e3;return o.a.map(t,(function(e){return e-r}))},setAlias:function(e,t){var r,a,o,s,u,l,c,p,f;if((null===(r=t.fields)||void 0===r?void 0:r.length)<=2){var h=t.fields.find((function(e){return e.name===n.TIME_SERIES_VALUE_FIELD_NAME}));return(null===(o=null===(a=null==h?void 0:h.config)||void 0===a?void 0:a.custom)||void 0===o?void 0:o.scopedVars)&&(e=Object(i.getTemplateSrv)().replace(e,null===(u=null===(s=null==h?void 0:h.config)||void 0===s?void 0:s.custom)||void 0===u?void 0:u.scopedVars)),h&&(h.config.displayNameFromDS=e),t.name=e,t}for(var d=0;d<t.fields.length;d++){var m=t.fields[d];m.type!==n.FieldType.time&&((null===(c=null===(l=null==m?void 0:m.config)||void 0===l?void 0:l.custom)||void 0===c?void 0:c.scopedVars)&&(e=Object(i.getTemplateSrv)().replace(e,null===(f=null===(p=null==m?void 0:m.config)||void 0===p?void 0:p.custom)||void 0===f?void 0:f.scopedVars)),m.config.displayNameFromDS=e)}return t},setAliasByRegex:function(e,t){var r,i,a;if((null===(r=t.fields)||void 0===r?void 0:r.length)<=2){var o=t.fields.find((function(e){return e.name===n.TIME_SERIES_VALUE_FIELD_NAME}));try{o&&(o.config.displayNameFromDS=T(null===(i=o.config)||void 0===i?void 0:i.displayNameFromDS,e)),t.name=T(t.name,e)}catch(e){console.error("Failed to apply RegExp:",(null==e?void 0:e.message)||e)}return t}for(var s=0,u=t.fields;s<u.length;s++){var l=u[s];if(l.type!==n.FieldType.time)try{l.config.displayNameFromDS=T(null===(a=l.config)||void 0===a?void 0:a.displayNameFromDS,e)}catch(e){console.error("Failed to apply RegExp:",(null==e?void 0:e.message)||e)}}return t},replaceAlias:function(e,t,r){var a,o,s,u,l,c,f,h;if(h=p.m(e)?p.a(e):e,(null===(a=r.fields)||void 0===a?void 0:a.length)<=2){var d=r.name.replace(h,t),m=r.fields.find((function(e){return e.name===n.TIME_SERIES_VALUE_FIELD_NAME}));return(null===(o=null==m?void 0:m.state)||void 0===o?void 0:o.scopedVars)&&(d=Object(i.getTemplateSrv)().replace(d,null===(s=null==m?void 0:m.state)||void 0===s?void 0:s.scopedVars)),m&&(m.config.displayNameFromDS=d),r.name=d,r}for(var v=0,g=r.fields;v<g.length;v++){var y=g[v];if(y.type!==n.FieldType.time){d=null===(l=null===(u=y.config)||void 0===u?void 0:u.displayNameFromDS)||void 0===l?void 0:l.replace(h,t);(null===(c=null==y?void 0:y.state)||void 0===c?void 0:c.scopedVars)&&d&&(d=Object(i.getTemplateSrv)().replace(d,null===(f=null==y?void 0:y.state)||void 0===f?void 0:f.scopedVars)),y.name=d||y.name}}return r}},w={get metricFunctions(){return I}},A=r(40),S=r.n(A),P=function(e,t,r){if(r||2===arguments.length)for(var n,i=0,a=t.length;i<a;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))};function O(e,t,r,n){var i=o.a.groupBy(e,"itemid"),a=o.a.uniqBy(o.a.flatten(o.a.map(t,"hosts")),"hostid");return o.a.map(i,(function(e,i){var s=o.a.find(t,{itemid:i}),u=s.name,l={__zbx_item:{value:s.name},__zbx_item_name:{value:s.name},__zbx_item_key:{value:s.key_},__zbx_item_interval:{value:s.delay}};if(o.a.keys(a).length>0){var c=o.a.find(a,{hostid:s.hostid});l.__zbx_host={value:c.host},l.__zbx_host_name={value:c.name},o.a.keys(a).length>1&&r&&(u=c.name+": "+u)}return{target:u,datapoints:o.a.map(e,n),scopedVars:l,item:s}}))}function D(e,t){var r=t.value;return e.textFilter&&(r=R(t.value,e.textFilter,e.useCaptureGroups)),[r,1e3*t.clock+Math.round(t.ns/1e6)]}function R(e,t,r){var n=new RegExp(t).exec(e);return n?r?n[1]:n[0]:""}function _(e){return[Number(e.value),1e3*e.clock+Math.round(e.ns/1e6)]}function C(e,t){var r;switch(e){case"min":r=t.value_min;break;case"max":r=t.value_max;break;case"avg":r=t.value_avg;break;case"sum":r=t.value_avg*t.num;break;case"count":r=t.num;break;default:r=t.value_avg}return[Number(r),1e3*t.clock]}var N={handleHistory:function(e,t,r){return void 0===r&&(r=!0),O(e,t,r,_)},convertHistory:O,handleTrends:function(e,t,r,n){return void 0===n&&(n=!0),O(e,t,n,o.a.partial(C,r))},handleText:function(e,t,r,n){return void 0===n&&(n=!0),O(e,t,n,o.a.partial(D,r))},handleHistoryAsTable:function(e,t,r){var n=new S.a;n.addColumn({text:"Host"}),n.addColumn({text:"Item"}),n.addColumn({text:"Key"}),n.addColumn({text:"Last value"});var i=o.a.groupBy(e,"itemid");return o.a.each(t,(function(e){var t=i[e.itemid]||[],a=o.a.last(t),s=a?a.value:null;if(!r.options.skipEmptyValues||s&&""!==s){r.textFilter&&(s=R(s,r.textFilter,r.useCaptureGroups));var u=o.a.first(e.hosts);u=u?u.name:"",n.rows.push([u,e.name,e.key_,s])}})),n},handleSLAResponse:function(e,t,r){var n=r[e.serviceid].sla;if("status"===t.property){var i=parseInt(r[e.serviceid].status,10);return{target:e.name+" "+t.name,datapoints:[[i,1e3*n[0].to]]}}var a=void 0,o=[];for(a=0;a<n.length;a++)0===a&&o.push([n[a][t.property],1e3*n[a].from]),o.push([n[a][t.property],1e3*n[a].to]);return{target:e.name+" "+t.name,datapoints:o}},handleTriggersResponse:function(e,t,r){if(o.a.isArray(e)){var n=function(e){var t=o.a.uniq(o.a.flattenDeep(o.a.map(e,(function(e){return o.a.map(e.groups,"name")})))),r={};return o.a.each(t,(function(e){r[e]={0:0,1:0,2:0,3:0,4:0,5:0}})),o.a.each(e,(function(e){o.a.each(e.groups,(function(t){r[t.name][e.priority]++}))})),r}(e),i=o.a.map(t,"name"),a=new S.a;return a.addColumn({text:"Host group"}),o.a.each(o.a.orderBy(f.l,["val"],["desc"]),(function(e){a.addColumn({text:e.text})})),o.a.each(n,(function(e,t){if(o.a.includes(i,t)){var r=o.a.map(o.a.orderBy(o.a.toPairs(e),(function(e){return e[0]}),["desc"]),(function(e){return e[1]}));r=o.a.concat.apply(o.a,P([[t]],r,!1)),a.rows.push(r)}})),a}var s=null;try{s=Number(e)}catch(e){console.log("Error when handling triggers count: ",e)}return{target:"triggers count",datapoints:[[s,1e3*r[1]]]}},sortTimeseries:function(e){return o.a.forEach(e,(function(e){e.datapoints=o.a.sortBy(e.datapoints,(function(e){return e[f.a]}))})),e},seriesToDataFrame:function(e,t,r,i){var a,o,s,u,l,c,h,d=e.datapoints,m=e.scopedVars,v=e.target,g=e.item,y={name:n.TIME_SERIES_TIME_FIELD_NAME,type:n.FieldType.time,config:{custom:{}},values:new n.ArrayVector(d.map((function(e){return e[f.a]})))};h=(n.FieldType.string,new n.ArrayVector(d.map((function(e){return e[f.b]}))));var b={name:n.TIME_SERIES_VALUE_FIELD_NAME,type:null!=i?i:n.FieldType.number,labels:{},config:{displayNameFromDS:v,custom:{}},values:h};if(m&&(y.config.custom={itemInterval:null===(a=m.__zbx_item_interval)||void 0===a?void 0:a.value},b.labels={host:null===(o=m.__zbx_host_name)||void 0===o?void 0:o.value,item:null===(s=m.__zbx_item)||void 0===s?void 0:s.value,item_key:null===(u=m.__zbx_item_key)||void 0===u?void 0:u.value},b.config.custom={itemInterval:null===(l=m.__zbx_item_interval)||void 0===l?void 0:l.value}),g){var E=p.d(g.units);E&&(console.log("Datasource: unit detected: "+E+" ("+g.units+")"),b.config.unit=E,"percent"===E&&(b.config.min=0,b.config.max=100));var x=p.j(g,r);x&&(null===(c=t.options)||void 0===c?void 0:c.useZabbixValueMapping)&&(console.log("Datasource: using Zabbix value mapping"),b.config.mappings=x)}var T=[y,b],I={name:v,refId:t.refId,fields:T,length:d.length};return new n.MutableDataFrame(I)},dataResponseToTimeSeries:function(e,t,r){var i,a=[];if(0===e.length)return[];for(var s=0,u=e;s<u.length;s++)for(var l=u[s],c=Object(n.dataFrameFromJSON)(l),f=Object(n.getTimeField)(c),h=f.timeField,d=f.timeIndex,m=0;m<c.fields.length;m++){var v=c.fields[m];if(m!==d&&v.values&&v.values.length){for(var g=[],y=0;y<v.values.length;y++){var b=v.values.get(y);null!==b&&g.push({time:h.values.get(y)/1e3,value:b})}var E=v.name,x=o.a.find(t,{itemid:E}),T=1e6*r.intervalMs,I=1e6*p.r(x.delay);0===(T=Math.max(T,I))&&(T=null);var w=x.name;(null===(i=x.hosts)||void 0===i?void 0:i.length)>0&&(w=x.hosts[0].name+": "+w);var A={ts:g,meta:{name:w,item:x,interval:T}};a.push(A)}}return a},itServiceResponseToTimeSeries:function(e,t){var r=[];if(0===e.length)return[];for(var n=0,i=e;n<i.length;n++){var a=i[n],o=[];if(a.datapoints){for(var s=a.datapoints,u=0;u<s.length;u++)o.push({time:s[u][1]/1e3,value:s[u][0]});var l=1e6*p.r(t);0===l&&(l=null);var c={ts:o,meta:{name:a.target,interval:null,item:{}}};r.push(c)}}return r},isConvertibleToWide:function(e){if(!e||e.length<2)return!1;var t=e[0].fields.find((function(e){return e.type===n.FieldType.time}));if(!t)return!1;for(var r=1;r<e.length;r++)for(var i=e[r].fields.find((function(e){return e.type===n.FieldType.time})),a=0;a<Math.min(e.length,2);a++)if(i.values.get(a)!==t.values.get(a))return!1;return!0},convertToWide:function(e){var t=function(e){for(var t=0,r=0,i=0;i<e.length;i++){var a=e[i].fields.find((function(e){return e.type===n.FieldType.time}));a.values.length>r&&(r=a.values.length,t=i)}return t}(e),r=e[t].fields.find((function(e){return e.type===n.FieldType.time}));if(!r)return[];for(var i=[r],a=0;a<e.length;a++){var o=e[a].fields.find((function(e){return e.name===n.TIME_SERIES_VALUE_FIELD_NAME}));o&&(o.name=e[a].name,r.values.length-o.values.length==1&&o.values.add(null),i.push(o))}return[{name:"wide",fields:i,length:r.values.length}]},alignFrames:function(e){var t;if(!e||0===e.length)return e;for(var r=e[0].fields.find((function(e){return e.name===n.TIME_SERIES_TIME_FIELD_NAME})).values.get(0),i=0;i<e.length;i++){(a=(s=e[i].fields.find((function(e){return e.name===n.TIME_SERIES_TIME_FIELD_NAME}))).values.get(0))<r&&(r=a)}for(i=0;i<e.length;i++){var a,o=e[i],s=o.fields.find((function(e){return e.name===n.TIME_SERIES_TIME_FIELD_NAME})),u=o.fields.find((function(e){return e.name===n.TIME_SERIES_VALUE_FIELD_NAME}));if((a=s.values.get(0))>r){console.log("Data frames: adding missing points");for(var l=s.values.toArray(),c=u.values.toArray(),p=[],f=[],h=null===(t=s.config.custom)||void 0===t?void 0:t.itemInterval,d=r;d<a;d+=h)p.push(d),f.push(null);l=p.concat(l),c=f.concat(c),s.values=new n.ArrayVector(l),u.values=new n.ArrayVector(c)}}return e},convertZabbixUnits:function(e){for(var t,r=0;r<e.data.length;r++)for(var n=0,i=e.data[r].fields;n<i.length;n++){var a=i[n],o=null===(t=a.config.custom)||void 0===t?void 0:t.units;if(o){var s=p.d(o);s&&(a.config.unit=s,"percent"===s&&(a.config.min=0,a.config.max=100))}}return e}};function L(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n],a=t[Number(i.objectid)];if(a){var o={timestamp:Number(i.clock),triggerid:i.objectid,eventid:i.eventid,name:i.name,severity:i.severity,acknowledged:i.acknowledged,acknowledges:i.acknowledges,tags:i.tags,suppressed:i.suppressed,suppression_data:i.suppression_data,description:i.name||a.description,comments:a.comments,value:a.value,groups:a.groups,hosts:a.hosts,items:a.items,alerts:a.alerts,url:a.url,expression:a.expression,correlation_mode:a.correlation_mode,correlation_tag:a.correlation_tag,manual_close:a.manual_close,state:a.state,error:a.error};r.push(o)}}return r}function k(e,t,r){for(var n=r.valueFromEvent,i=[],a=0;a<e.length;a++){var o=e[a],s=t[Number(o.objectid)];if(s){var u={value:n?o.value:s.value,timestamp:Number(o.clock),triggerid:o.objectid,eventid:o.eventid,name:o.name,severity:o.severity,acknowledged:o.acknowledged,acknowledges:o.acknowledges,tags:o.tags,suppressed:o.suppressed,description:s.description,comments:s.comments,groups:s.groups,hosts:s.hosts,items:s.items,alerts:s.alerts,url:s.url,expression:s.expression,correlation_mode:s.correlation_mode,correlation_tag:s.correlation_tag,manual_close:s.manual_close,state:s.state,error:s.error};i.push(u)}}return i}var F={addTriggerDataSource:function(e,t){return o.a.each(e,(function(e){e.datasource=t.datasource})),e},addTriggerHostProxy:function(e,t){return e.forEach((function(e){if(e.hosts&&e.hosts.length){var r=e.hosts[0];if("0"!==r.proxy_hostid){var n=t[r.proxy_hostid];r.proxy=n?n.host:""}}})),e},setMaintenanceStatus:function(e){return o.a.each(e,(function(e){var t=o.a.some(e.hosts,(function(e){return"1"===e.maintenance_status}));e.maintenance=t})),e},setAckButtonStatus:function(e,t){return o.a.each(e,(function(e){e.showAckButton=t})),e},filterTriggersPre:function(e,t){var r=t.trigger.filter;return r&&(e=function(e,t){return p.m(t)?o.a.filter(e,(function(e){return p.a(t).test(e.description)})):o.a.filter(e,(function(e){return e.description===t}))}(e,r)),t.options.hostsInMaintenance||(e=o.a.filter(e,(function(e){return!e.maintenance}))),e},sortProblems:function(e,t){var r,n;return"severity"===(null===(r=t.options)||void 0===r?void 0:r.sortProblems)?e=o.a.orderBy(e,["severity","eventid"],["desc","desc"]):"lastchange"===(null===(n=t.options)||void 0===n?void 0:n.sortProblems)&&(e=o.a.orderBy(e,["timestamp","eventid"],["desc","desc"])),e},toDataFrame:function(e){return{name:"problems",fields:[{name:"Problems",type:n.FieldType.other,values:new n.ArrayVector(e),config:{custom:{type:"problems"}}}],length:e.length}},joinTriggersWithProblems:L,joinTriggersWithEvents:k},$=r(11),M=r.n($),j=r(20),q=r.n(j),V=function(){function e(e){this.cacheEnabled=e.enabled,this.ttl=e.ttl||6e5,this.cache={},this.promises={}}return e.prototype.cacheRequest=function(e,t,r){return function(e,t,r,n){return function(){n.cache[t]||(n.cache[t]={});var i=n.cache[t],a=B(arguments);return n.cacheEnabled&&!n._isExpired(i[a])?Promise.resolve(i[a].value):e.apply(r,arguments).then((function(e){return void 0!==e&&(i[a]={value:e,timestamp:Date.now()}),e}))}}(e,t,r,this)},e.prototype.proxify=function(e,t,r){return this.promises[t]||(this.promises[t]={}),function(e,t,r){return function(){var n=B(arguments);return t[n]||(t[n]=Promise.resolve(e.apply(r,arguments).then((function(e){return t[n]=null,e})).catch((function(e){throw t[n]=null,e})))),t[n]}}(e,this.promises[t],r)},e.prototype.proxifyWithCache=function(e,t,r){var n=this.proxify(e,t,r);return this.cacheRequest(n,t,r)},e.prototype._isExpired=function(e){if(e){var t=Date.now()-e.timestamp;return!(e.timestamp&&t<this.ttl)}return!0},e}();function B(e){return function(e){var t,r,n,i=0;if(0!==e.length)for(t=0,n=e.length;t<n;t++)r=e.charCodeAt(t),i=(i<<5)-i+r,i|=0;return i}(JSON.stringify(e))}var H={0:"history",1:"history_str",2:"history_log",3:"history_uint",4:"history_text"},z={0:"trends",3:"trends_uint"},G={avg:"value_avg",min:"value_min",max:"value_max",sum:"num*value_avg"},U=function(){function e(e){this.datasourceId=e.datasourceId,this.datasourceName=e.datasourceName,this.datasourceTypeId=null,this.datasourceTypeName=null}return e.loadDatasource=function(e,t){if(!t&&void 0!==e){var r=o.a.find(Object(i.getDataSourceSrv)().getList(),{id:e});if(!r)return Promise.reject("Data Source with ID "+e+" not found");t=r.name}return t?Object(i.getDataSourceSrv)().get(t):Promise.reject("Data Source name should be specified")},e.prototype.loadDBDataSource=function(){var t=this;return e.loadDatasource(this.datasourceId,this.datasourceName).then((function(e){return t.datasourceTypeId=e.meta.id,t.datasourceTypeName=e.meta.name,t.datasourceName||(t.datasourceName=e.name),t.datasourceId||(t.datasourceId=e.id),e}))},e}(),Q={DBConnector:U,DEFAULT_QUERY_LIMIT:1e4,HISTORY_TO_TABLE_MAP:H,TREND_TO_TABLE_MAP:z,consolidateByFunc:{avg:"AVG",min:"MIN",max:"MAX",sum:"SUM",count:"COUNT"},consolidateByTrendColumns:G},X=r(41),W=r.n(X),Z=r(7),Y=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},J=function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},K=(null===n.rangeUtil||void 0===n.rangeUtil?void 0:n.rangeUtil.roundInterval)||W.a.roundInterval||W.a.round_interval,ee=function(){function e(e,t,r){this.datasourceId=r,this.backendAPIUrl="/api/datasources/"+this.datasourceId+"/resources/zabbix-api",this.requestOptions={basicAuth:e,withCredentials:t},this.getTrend=this.getTrend_ZBXNEXT1193,this.initVersion()}return e.prototype.request=function(e,t){var r=this;return this.version?this.backendAPIRequest(e,t):this.initVersion().then((function(){return r.request(e,t)}))},e.prototype.backendAPIRequest=function(e,t){var r;return void 0===t&&(t={}),Y(this,void 0,void 0,(function(){var n,a;return J(this,(function(o){switch(o.label){case 0:return n={url:this.backendAPIUrl,method:"POST",headers:{"Content-Type":"application/json"},hideFromInspector:!1,data:{datasourceId:this.datasourceId,method:e,params:t}},(this.requestOptions.basicAuth||this.requestOptions.withCredentials)&&(n.withCredentials=!0),this.requestOptions.basicAuth&&(n.headers.Authorization=this.requestOptions.basicAuth),[4,Object(i.getBackendSrv)().fetch(n).toPromise()];case 1:return a=o.sent(),[2,null===(r=null==a?void 0:a.data)||void 0===r?void 0:r.result]}}))}))},e.prototype.getVersion=function(){return this.backendAPIRequest("apiinfo.version")},e.prototype.initVersion=function(){var e=this;return this.getVersionPromise||(this.getVersionPromise=Promise.resolve(this.getVersion().then((function(t){return t?console.log("Zabbix version detected: "+t):console.log("Failed to detect Zabbix version, use default 3.0.0"),e.version=t||"3.0.0",e.getVersionPromise=null,t})))),this.getVersionPromise},e.prototype.isZabbix54OrHigher=function(){return q.a.gte(this.version,"5.4.0")},e.prototype.acknowledgeEvent=function(e,t,r,n){r||(r=q.a.gte(this.version,"4.0.0")?f.o:f.r);var i={eventids:e,message:t,action:r};return void 0!==n&&(i.severity=n),this.request("event.acknowledge",i)},e.prototype.getGroups=function(){return this.request("hostgroup.get",{output:["name","groupid"],sortfield:"name",real_hosts:!0})},e.prototype.getHosts=function(e){var t={output:["hostid","name","host"],sortfield:"name"};return e&&(t.groupids=e),this.request("host.get",t)},e.prototype.getApps=function(e){return Y(this,void 0,Promise,(function(){var t;return J(this,(function(r){return this.isZabbix54OrHigher()?[2,[]]:(t={output:"extend",hostids:e},[2,this.request("application.get",t)])}))}))},e.prototype.getItems=function(e,t,r){var n={output:["itemid","name","key_","value_type","hostid","status","state","units","valuemapid","delay"],sortfield:"name",webitems:!0,filter:{},selectHosts:["hostid","name","host"]};return e&&(n.hostids=e),t&&(n.applicationids=t),"num"===r&&(n.filter.value_type=[0,3]),"text"===r&&(n.filter.value_type=[1,2,4]),this.isZabbix54OrHigher()&&(n.selectTags="extend"),this.request("item.get",n).then(p.g)},e.prototype.getItemsByIDs=function(e){var t={itemids:e,output:["itemid","name","key_","value_type","hostid","status","state","units","valuemapid","delay"],webitems:!0,selectHosts:["hostid","name"]};return this.isZabbix54OrHigher()&&(t.selectTags="extend"),this.request("item.get",t).then((function(e){return p.g(e)}))},e.prototype.getMacros=function(e){var t={output:"extend",hostids:e};return this.request("usermacro.get",t)},e.prototype.getGlobalMacros=function(){return this.request("usermacro.get",{output:"extend",globalmacro:!0})},e.prototype.getLastValue=function(e){var t={output:["lastvalue"],itemids:e};return this.request("item.get",t).then((function(e){return e.length?e[0].lastvalue:null}))},e.prototype.getHistory=function(e,t,r){var n=this,i=o.a.groupBy(e,"value_type"),a=o.a.map(i,(function(e,i){var a={output:"extend",history:i,itemids:o.a.map(e,"itemid"),sortfield:"clock",sortorder:"ASC",time_from:t};return r&&(a.time_till=r),n.request("history.get",a)}));return Promise.all(a).then(o.a.flatten)},e.prototype.getTrend_ZBXNEXT1193=function(e,t,r){var n=this,i=o.a.groupBy(e,"value_type"),a=o.a.map(i,(function(e,i){var a={output:"extend",trend:i,itemids:o.a.map(e,"itemid"),sortfield:"clock",sortorder:"ASC",time_from:t};return r&&(a.time_till=r),n.request("trend.get",a)}));return Promise.all(a).then(o.a.flatten)},e.prototype.getTrend_30=function(e,t,r,n){var i={output:["itemid","clock",n],itemids:o.a.map(e,"itemid"),time_from:t};return r&&(i.time_till=r),this.request("trend.get",i)},e.prototype.getITService=function(e){var t={output:"extend",serviceids:e};return this.request("service.get",t)},e.prototype.getSLA=function(e,t,r){var n=[{from:t[0],to:t[1]}];if("auto"===r.slaInterval)n=re(t,te(r.intervalMs));else if("none"!==r.slaInterval){n=re(t,p.q(r.slaInterval)/1e3)}var i={serviceids:e,intervals:n};return this.request("service.getsla",i)},e.prototype.getSLA60=function(e,t,r){return Y(this,void 0,void 0,(function(){var n,i,a,o,s,u,l,c,f,h;return J(this,(function(d){switch(d.label){case 0:return n=t[0],i=t[1],a=[{from:n,to:i}],"auto"===r.slaInterval?(o=te(r.intervalMs),a=re(t,o)):"none"!==r.slaInterval&&(o=p.q(r.slaInterval)/1e3,a=re(t,o)),s={output:"extend",serviceids:e},[4,this.request("sla.get",s)];case 1:return 0===(u=d.sent()).length?[2,{}]:(l=u[0],a.map((function(e){return{period_from:e.from,period_to:e.to}})),c={slaid:l.slaid,serviceids:e,period_from:n,period_to:i,periods:Math.min(a.length,100)},[4,this.request("sla.getsli",c)]);case 2:return 0===(f=d.sent()).length?[2,{}]:(h={},f.serviceids.forEach((function(e){h[e]={sla:[]}})),f.sli.forEach((function(e,t){e.forEach((function(e,r){h[f.serviceids[r]].sla.push({downtimeTime:e.downtime,okTime:e.uptime,sla:e.sli,from:f.periods[t].period_from,to:f.periods[t].period_to})}))})),[2,h])}}))}))},e.prototype.getProblems=function(e,t,r,n){var i=n.timeFrom,a=n.timeTo,o=n.recent,s=n.severities,u=n.limit,l=n.acknowledged,c=n.tags,f={output:"extend",selectAcknowledges:"extend",selectSuppressionData:"extend",selectTags:"extend",source:"0",object:"0",sortfield:["eventid"],sortorder:"DESC",evaltype:"0",groupids:e,hostids:t,applicationids:r,recent:o};return s&&(f.severities=s),void 0!==l&&(f.acknowledged=l),c&&(f.tags=c),u&&(f.limit=u),(i||a)&&(f.time_from=i,f.time_till=a),this.request("problem.get",f).then(p.p)},e.prototype.getTriggersByIds=function(e){var t={output:"extend",triggerids:e,expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,skipDependent:!0,selectGroups:["name","groupid"],selectHosts:["hostid","name","host","maintenance_status","proxy_hostid"],selectItems:["itemid","name","key_","lastvalue"],preservekeys:"1"};return this.request("trigger.get",t).then(p.p)},e.prototype.getTriggers=function(e,t,r,n){var i=n.showTriggers,a=n.maintenance,o=n.timeFrom,s=n.timeTo,u={output:"extend",groupids:e,hostids:t,applicationids:r,expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,skipDependent:!0,filter:{value:1},selectGroups:["groupid","name"],selectHosts:["hostid","name","host","maintenance_status","proxy_hostid"],selectItems:["itemid","name","key_","lastvalue"],selectLastEvent:"extend",selectTags:"extend"};return i===Z.a.Problems?u.filter.value=1:i!==Z.a.Recent&&i!==Z.a.History||(u.filter.value=[0,1]),a&&(u.maintenance=!0),(o||s)&&(u.lastChangeSince=o,u.lastChangeTill=s),this.request("trigger.get",u)},e.prototype.getEvents=function(e,t,r,n,i){var a={output:"extend",time_from:t,time_till:r,objectids:e,select_acknowledges:"extend",selectHosts:"extend",value:n};return i&&(a.limit=i,a.sortfield="clock",a.sortorder="DESC"),this.request("event.get",a).then(p.p)},e.prototype.getEventsHistory=function(e,t,r,n){var i=n.timeFrom,a=n.timeTo,o=n.severities,s=n.limit,u=n.value,l={output:"extend",time_from:i,time_till:a,value:"1",source:"0",object:"0",evaltype:"0",sortfield:["eventid"],sortorder:"DESC",select_acknowledges:"extend",selectTags:"extend",selectSuppressionData:["maintenanceid","suppress_until"],groupids:e,hostids:t,applicationids:r};return s&&(l.limit=s),o&&(l.severities=o),u&&(l.value=u),this.request("event.get",l).then(p.p)},e.prototype.getExtendedEventData=function(e){var t={output:"extend",eventids:e,preservekeys:!0,select_acknowledges:"extend",selectTags:"extend",sortfield:"clock",sortorder:"DESC"};return this.request("event.get",t)},e.prototype.getEventAlerts=function(e){var t={eventids:e,output:["alertid","eventid","message","clock","error"],selectUsers:!0};return this.request("alert.get",t)},e.prototype.getAcknowledges=function(e){var t={output:"extend",eventids:e,preservekeys:!0,select_acknowledges:"extend",sortfield:"clock",sortorder:"DESC"};return this.request("event.get",t).then((function(e){return o.a.filter(e,(function(e){return e.acknowledges.length}))}))},e.prototype.getAlerts=function(e,t,r){var n={output:"extend",itemids:e,expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,skipDependent:!0,selectLastEvent:"extend"};return(t||r)&&(n.lastChangeSince=t,n.lastChangeTill=r),this.request("trigger.get",n)},e.prototype.getHostAlerts=function(e,t,r){var n=r.minSeverity,i=r.acknowledged,a=r.count,s=r.timeFrom,u=r.timeTo,l={output:"extend",hostids:e,min_severity:n,filter:{value:1},expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,skipDependent:!0,selectLastEvent:"extend",selectGroups:"extend",selectHosts:["hostid","host","name"]};return a&&0!==i&&1!==i&&(l.countOutput=!0),t&&t.length&&(l.applicationids=t),(s||u)&&(l.lastChangeSince=s,l.lastChangeTill=u),this.request("trigger.get",l).then((function(e){return a&&0!==i&&1!==i||(e=function(e,t){return 0===t?o.a.filter(e,(function(e){return"0"===e.lastEvent.acknowledged})):1===t?o.a.filter(e,(function(e){return"1"===e.lastEvent.acknowledged})):e}(e,i),a&&(e=e.length)),e}))},e.prototype.getProxies=function(){return this.request("proxy.get",{output:["proxyid","host"]})},e.prototype.getScripts=function(e,t){var r={output:"extend",hostids:e};return this.request("script.get",r).then(p.p)},e.prototype.executeScript=function(e,t){var r={hostid:e,scriptid:t};return this.request("script.execute",r)},e.prototype.getValueMappings=function(){return this.request("valuemap.get",{output:"extend",selectMappings:"extend"})},e}();function te(e){var t=K(100*e)/1e3;return Math.max(t,f.d)}function re(e,t){var r=e[0],n=e[1],i=[];r=Math.floor(r/t)*t,n=Math.ceil(n/t)*t;for(var a=r;a<=n-t;a+=t)i.push({from:a,to:a+t});return i}var ne=function(){function e(e){this.code=e.code||null,this.name=e.message||"",this.data=e.data||"",this.message="Zabbix API Error: "+this.name+" "+this.data}return e.prototype.toString=function(){return this.name+" "+this.data},e}();var ie={historyQuery:function(e,t,r,n,i,a){var o="clock DIV "+i+" * "+i;return"\n      SELECT CAST(itemid AS CHAR) AS metric, "+o+" AS time_sec, "+a+"(value) AS value\n      FROM "+t+"\n      WHERE itemid IN ("+e+")\n        AND clock\n          > "+r+"\n        AND clock\n          < "+n+"\n      GROUP BY "+o+", metric\n      ORDER BY time_sec ASC\n  "},trendsQuery:function(e,t,r,n,i,a,o){var s="clock DIV "+i+" * "+i;return"\n      SELECT CAST(itemid AS CHAR) AS metric, "+s+" AS time_sec, "+a+"("+o+") AS value\n      FROM "+t+"\n      WHERE itemid IN ("+e+")\n        AND clock\n          > "+r+"\n        AND clock\n          < "+n+"\n      GROUP BY "+s+", metric\n      ORDER BY time_sec ASC\n  "},testQuery:function(){return"SELECT CAST(itemid AS CHAR) AS metric, clock AS time_sec, value_avg AS value\n          FROM trends_uint LIMIT 1"}};var ae,oe={historyQuery:function(e,t,r,n,i,a){return"\n      SELECT to_char(itemid, 'FM99999999999999999999') AS metric, "+("clock / "+i+" * "+i)+" AS time, "+a+"(value) AS value\n      FROM "+t+"\n      WHERE itemid IN ("+e+")\n        AND clock\n          > "+r+"\n        AND clock\n          < "+n+"\n      GROUP BY 1, 2\n      ORDER BY time ASC\n  "},trendsQuery:function(e,t,r,n,i,a,o){return"\n      SELECT to_char(itemid, 'FM99999999999999999999') AS metric, "+("clock / "+i+" * "+i)+" AS time, "+a+"("+o+") AS value\n      FROM "+t+"\n      WHERE itemid IN ("+e+")\n        AND clock\n          > "+r+"\n        AND clock\n          < "+n+"\n      GROUP BY 1, 2\n      ORDER BY time ASC\n  "},testQuery:function(){return"\n    SELECT to_char(itemid, 'FM99999999999999999999') AS metric, clock AS time, value_avg AS value\n    FROM trends_uint LIMIT 1\n"}},se=(ae=function(e,t){return(ae=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}ae(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),ue="postgres",le=function(e){function t(t){var r=e.call(this,t)||this;return r.limit=t.limit||1e4,r.sqlDialect=null,e.prototype.loadDBDataSource.call(r).then((function(){r.loadSQLDialect()})),r}return se(t,e),t.prototype.loadSQLDialect=function(){this.datasourceTypeId===ue?this.sqlDialect=oe:this.sqlDialect=ie},t.prototype.testDataSource=function(){var e=this.sqlDialect.testQuery();return this.invokeSQLQuery(e)},t.prototype.getHistory=function(e,t,r,n){var i=this,a=ce(t,r,n),s=a.aggFunction,u=a.intervalSec,l=o.a.groupBy(e,"value_type"),c=o.a.map(l,(function(e,n){var a=o.a.map(e,"itemid").join(", "),l=H[n],c=i.sqlDialect.historyQuery(a,l,t,r,u,s);return c=Object(p.b)(c),i.invokeSQLQuery(c)}));return Promise.all(c).then((function(e){return o.a.flatten(e)}))},t.prototype.getTrends=function(e,t,r,n){var i=this,a=n.consolidateBy,s=ce(t,r,n),u=s.aggFunction,l=s.intervalSec,c=o.a.groupBy(e,"value_type"),f=o.a.map(c,(function(e,n){var s=o.a.map(e,"itemid").join(", "),c=z[n],f=o.a.includes(["avg","min","max","sum"],a)?a:"avg";f=Q.consolidateByTrendColumns[f];var h=i.sqlDialect.trendsQuery(s,c,t,r,l,u,f);return h=Object(p.b)(h),i.invokeSQLQuery(h)}));return Promise.all(f).then((function(e){return o.a.flatten(e)}))},t.prototype.invokeSQLQuery=function(e){var t={refId:"A",format:"time_series",datasourceId:this.datasourceId,rawSql:e,maxDataPoints:this.limit};return Object(i.getBackendSrv)().datasourceRequest({url:"/api/ds/query",method:"POST",data:{queries:[t]}}).then((function(e){var t=e.data.results;return t.A?t.A.frames:null}))},t}(U);function ce(e,t,r){var n=r.intervalMs,i=r.consolidateBy,a=Math.ceil(n/1e3),o=Math.ceil((t-e)/a);return a=Math.ceil((t-e)/o),{aggFunction:Q.consolidateByFunc[i=i||"avg"],intervalSec:a}}var pe=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),fe=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},he=function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},de={avg:"MEAN",min:"MIN",max:"MAX",sum:"SUM",count:"COUNT"},me=function(e){function t(t){var r=e.call(this,t)||this;return r.retentionPolicy=t.retentionPolicy,e.prototype.loadDBDataSource.call(r).then((function(e){return r.influxDS=e,e})),r}return pe(t,e),t.prototype.testDataSource=function(){return this.influxDS.testDatasource().then((function(e){return e.status&&"error"===e.status?Promise.reject({data:{message:"InfluxDB connection error: "+e.message}}):e}))},t.prototype.getHistory=function(e,t,r,i){var a=this,s=i.intervalMs,u=i.retentionPolicy,l=i.consolidateBy,c=Math.ceil(s/1e3),p={timeFrom:t,timeTill:r};l=l||"avg";var f=o.a.groupBy(e,"value_type"),h=o.a.map(f,(function(e,t){var r=o.a.map(e,"itemid"),n=H[t],i=a.buildHistoryQuery(r,n,p,c,l,u);return a.invokeInfluxDBQuery(i)}));return Promise.all(h).then(o.a.flatten).then((function(e){return function(e){var t,r;if(!e)return[];for(var i=[],a=0;a<e.length;a++){var o=e[a];if(o.error){var s="InfluxDB error: "+o.error;return Promise.reject(new Error(s))}if(o&&o.series)for(var u=e[a].series,l=0;l<u.length;l++){var c=u[l],p=[],f=[];if(c.values)for(a=0;a<c.values.length;a++)p.push(c.values[a][0]),f.push(c.values[a][1]);var h={name:n.TIME_SERIES_TIME_FIELD_NAME,type:n.FieldType.time,config:{},values:new n.ArrayVector(p)},d={name:null===(t=null==c?void 0:c.tags)||void 0===t?void 0:t.itemid,type:n.FieldType.number,config:{},values:new n.ArrayVector(f)};i.push(new n.MutableDataFrame({name:null===(r=null==c?void 0:c.tags)||void 0===r?void 0:r.itemid,fields:[h,d]}))}}return i.map((function(e){return Object(n.dataFrameToJSON)(e)}))}(e)}))},t.prototype.getTrends=function(e,t,r,n){return n.retentionPolicy=this.retentionPolicy,this.getHistory(e,t,r,n)},t.prototype.buildHistoryQuery=function(e,t,r,n,i,a){var o=r.timeFrom,s=r.timeTill,u="value";a&&(u=G[i]||"value_avg");var l="SELECT "+(de[i]||i)+'("'+u+'")\n                   FROM '+(a?'"'+a+'"."'+t+'"':'"'+t+'"')+"\n                   WHERE "+this.buildWhereClause(e)+'\n                     AND "time" >= '+o+'s\n                     AND "time" <= '+s+"s\n                   GROUP BY time("+n+'s), "itemid" fill(none)';return Object(p.b)(l)},t.prototype.buildWhereClause=function(e){return"("+e.map((function(e){return'"itemid" = \''+e+"'"})).join(" OR ")+")"},t.prototype.invokeInfluxDBQuery=function(e){return fe(this,void 0,void 0,(function(){var t;return he(this,(function(r){switch(r.label){case 0:return[4,this.influxDS._seriesQuery(e).toPromise()];case 1:return[2,(null==(t=r.sent())?void 0:t.results)||[]]}}))}))},t}(U);var ve=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},ge=function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},ye=function(e,t,r){if(r||2===arguments.length)for(var n,i=0,a=t.length;i<a;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},be=["getHistory","getTrend","getGroups","getHosts","getApps","getItems","getMacros","getItemsByIDs","getEvents","getAlerts","getHostAlerts","getAcknowledges","getITService","getSLA","getProxies","getEventAlerts","getExtendedEventData","getProblems","getEventsHistory","getTriggersByIds","getScripts","getValueMappings"],Ee=["getGroups","getHosts","getApps","getItems","getMacros","getItemsByIDs","getITService","getProxies","getValueMappings"],xe=["getHistory","getTrend","getMacros","getItemsByIDs","getEvents","getAlerts","getHostAlerts","getAcknowledges","getITService","acknowledgeEvent","getProxies","getEventAlerts","getExtendedEventData","getScripts","executeScript","getValueMappings"],Te=function(){function e(e){var t=this,r=e.basicAuth,n=e.withCredentials,i=e.cacheTTL,a=e.enableDirectDBConnection,o=e.dbConnectionDatasourceId,s=e.dbConnectionDatasourceName,u=e.dbConnectionRetentionPolicy,l=e.datasourceId;this.enableDirectDBConnection=a;var c={enabled:!0,ttl:i};if(this.cachingProxy=new V(c),this.zabbixAPI=new ee(r,n,l),this.proxifyRequests(),this.cacheRequests(),this.bindRequests(),a){var p={dbConnectionRetentionPolicy:u};this.initDBConnector(o,s,p).then((function(){t.getHistoryDB=t.cachingProxy.proxifyWithCache(t.dbConnector.getHistory,"getHistory",t.dbConnector),t.getTrendsDB=t.cachingProxy.proxifyWithCache(t.dbConnector.getTrends,"getTrends",t.dbConnector)}))}}return e.prototype.initDBConnector=function(e,t,r){var n=this;return U.loadDatasource(e,t).then((function(i){var a={datasourceId:e,datasourceName:t};return"influxdb"===i.type?(a.retentionPolicy=r.dbConnectionRetentionPolicy,n.dbConnector=new me(a)):n.dbConnector=new le(a),n.dbConnector}))},e.prototype.proxifyRequests=function(){for(var e=0,t=be;e<t.length;e++){var r=t[e];this.zabbixAPI[r]=this.cachingProxy.proxify(this.zabbixAPI[r],r,this.zabbixAPI)}},e.prototype.cacheRequests=function(){for(var e=0,t=Ee;e<t.length;e++){var r=t[e];this.zabbixAPI[r]=this.cachingProxy.cacheRequest(this.zabbixAPI[r],r,this.zabbixAPI)}},e.prototype.bindRequests=function(){for(var e=0,t=xe;e<t.length;e++){var r=t[e];this[r]=this.zabbixAPI[r].bind(this.zabbixAPI)}},e.prototype.testDataSource=function(){var e,t,r=this;return this.getVersion().then((function(t){return e=t,r.getAllGroups()})).then((function(){return r.enableDirectDBConnection?r.dbConnector.testDataSource():Promise.resolve()})).catch((function(e){return Promise.reject(e)})).then((function(n){return n&&(t={dsType:r.dbConnector.datasourceTypeName,dsName:r.dbConnector.datasourceName}),{zabbixVersion:e,dbConnectorStatus:t}}))},e.prototype.getVersion=function(){return ve(this,void 0,void 0,(function(){var e;return ge(this,(function(t){switch(t.label){case 0:return this.version?[3,3]:this.zabbixAPI.version?(this.version=this.zabbixAPI.version,[3,3]):[3,1];case 1:return e=this,[4,this.zabbixAPI.initVersion()];case 2:e.version=t.sent(),t.label=3;case 3:return[2,this.version]}}))}))},e.prototype.supportsApplications=function(){var e=this.version||this.zabbixAPI.version;return!e||q.a.lt(e,"5.4.0")},e.prototype.supportSLA=function(){var e=this.version||this.zabbixAPI.version;return!e||q.a.gte(e,"6.0.0")},e.prototype.isZabbix54OrHigher=function(){var e=this.version||this.zabbixAPI.version;return!!e&&q.a.gte(e,"5.4.0")},e.prototype.getItemsFromTarget=function(e,t){var r=o.a.map(["group","host","application","itemTag","item"],(function(t){return e[t].filter}));return this.getItems.apply(this,ye(ye([],r,!1),[t],!1))},e.prototype.getHostsFromTarget=function(e){var t=o.a.map(["group","host","application"],(function(t){return e[t].filter}));return Promise.all([this.getHosts.apply(this,t),this.getApps.apply(this,t)]).then((function(e){var t=e[0],r=e[1];return r.appFilterEmpty&&(r=[]),[t,r]}))},e.prototype.getAllGroups=function(){return this.zabbixAPI.getGroups()},e.prototype.getGroups=function(e){return this.getAllGroups().then((function(t){return we(t,e)}))},e.prototype.getAllHosts=function(e){var t=this;return this.getGroups(e).then((function(e){var r=o.a.map(e,"groupid");return t.zabbixAPI.getHosts(r)}))},e.prototype.getHosts=function(e,t){return this.getAllHosts(e).then((function(e){return we(e,t)}))},e.prototype.getAllApps=function(e,t){return ve(this,void 0,void 0,(function(){var r=this;return ge(this,(function(n){switch(n.label){case 0:return[4,this.getVersion()];case 1:return n.sent(),this.supportsApplications()?[2,this.getHosts(e,t).then((function(e){var t=o.a.map(e,"hostid");return r.zabbixAPI.getApps(t)}))]:[2,[]]}}))}))},e.prototype.getApps=function(e,t,r){return ve(this,void 0,Promise,(function(){var n,i=this;return ge(this,(function(a){switch(a.label){case 0:return[4,this.getVersion()];case 1:return a.sent(),n=!this.supportsApplications(),[2,this.getHosts(e,t).then((function(e){var t=o.a.map(e,"hostid");if(r&&!n)return i.zabbixAPI.getApps(t).then((function(e){return Ae(e,r)}));var a=t;return a.hostids=t,a.appFilterEmpty=!0,Promise.resolve(a)}))]}}))}))},e.prototype.getItemTags=function(e,t,r){return ve(this,void 0,void 0,(function(){var n,i;return ge(this,(function(a){switch(a.label){case 0:return[4,this.getAllItems(e,t,null,null,{})];case 1:return n=a.sent(),i=o.a.flatten(n.map((function(e){return e.tags?e.tags:[]}))),i=o.a.uniqBy(i,(function(e){return e.tag+e.value||""})),[2,we(i.map((function(e){return{name:p.o(e)}})),r)]}}))}))},e.prototype.getAllItems=function(e,t,r,n,i){return void 0===i&&(i={}),ve(this,void 0,void 0,(function(){var a,s,u;return ge(this,(function(l){switch(l.label){case 0:return[4,this.getApps(e,t,r)];case 1:return a=l.sent(),this.isZabbix54OrHigher()?[4,this.zabbixAPI.getItems(a.hostids,void 0,i.itemtype)]:[3,3];case 2:return s=l.sent(),n&&(s=function(e,t){if(p.m(t)){var r=p.a(t);return e.filter((function(e){return!!e.tags&&e.tags.map((function(e){return p.o(e)})).some((function(e){return r.test(e)}))}))}return e.filter((function(e){return!!e.tags&&e.tags.map((function(e){return p.o(e)})).includes(t)}))}(s,n)),[3,7];case 3:return a.appFilterEmpty?[4,this.zabbixAPI.getItems(a.hostids,void 0,i.itemtype)]:[3,5];case 4:return s=l.sent(),[3,7];case 5:return u=o.a.map(a,"applicationid"),[4,this.zabbixAPI.getItems(void 0,u,i.itemtype)];case 6:s=l.sent(),l.label=7;case 7:return i.showDisabledItems||(s=o.a.filter(s,{status:"0"})),[4,this.expandUserMacro(s,!1)];case 8:return[2,l.sent()]}}))}))},e.prototype.expandUserMacro=function(e,t){var r=function(e){var t=o.a.map(e,(function(e){return o.a.map(e.hosts,"hostid")}));return o.a.uniq(o.a.flatten(t))}(e);return this.getMacros(r).then((function(r){return o.a.forEach(e,(function(e){p.c(t?e.url:e.name)&&(t?e.url=p.v(e,r,t):e.name=p.v(e,r))})),e}))},e.prototype.getItems=function(e,t,r,n,i,a){return void 0===a&&(a={}),this.getAllItems(e,t,r,n,a).then((function(e){return Ae(e,i)}))},e.prototype.getItemValues=function(e,t,r,n,i){var a=this;return void 0===i&&(i={}),this.getItems(e,t,r,null,n,i).then((function(e){var t=[M()().subtract(2,"h").unix(),M()().unix()];i.range&&(t=[i.range.from.unix(),i.range.to.unix()]);var r=t[0],n=t[1];return a.zabbixAPI.getHistory(e,r,n).then((function(e){return e?o.a.uniq(e.map((function(e){return e.value}))).map((function(e){return{name:e}})):[]}))}))},e.prototype.getITServices=function(e){return this.zabbixAPI.getITService().then((function(t){return we(t,e)}))},e.prototype.getProblems=function(e,t,r,n,i){var a=this,s=[this.getGroups(e),this.getHosts(e,t),this.getApps(e,t,r)];return Promise.all(s).then((function(n){var i=n[0],a=n[1],s=n[2],u={};return r&&(u.applicationids=o.a.flatten(o.a.map(s,"applicationid"))),t&&"/.*/"!==t&&(u.hostids=o.a.map(a,"hostid")),e&&(u.groupids=o.a.map(i,"groupid")),u})).then((function(e){return a.zabbixAPI.getProblems(e.groupids,e.hostids,e.applicationids,i)})).then((function(e){var t=null==e?void 0:e.map((function(e){return e.objectid}));return Promise.all([Promise.resolve(e),a.zabbixAPI.getTriggersByIds(t)])})).then((function(e){return L(e[0],e[1])})).then((function(e){return a.filterTriggersByProxy(e,n)}))},e.prototype.getProblemsHistory=function(e,t,r,n,i){var a=this,s=i.valueFromEvent,u=[this.getGroups(e),this.getHosts(e,t),this.getApps(e,t,r)];return Promise.all(u).then((function(n){var i=n[0],a=n[1],s=n[2],u={};return r&&(u.applicationids=o.a.flatten(o.a.map(s,"applicationid"))),t&&(u.hostids=o.a.map(a,"hostid")),e&&(u.groupids=o.a.map(i,"groupid")),u})).then((function(e){return a.zabbixAPI.getEventsHistory(e.groupids,e.hostids,e.applicationids,i)})).then((function(e){var t=null==e?void 0:e.map((function(e){return e.objectid}));return Promise.all([Promise.resolve(e),a.zabbixAPI.getTriggersByIds(t)])})).then((function(e){return k(e[0],e[1],{valueFromEvent:s})})).then((function(e){return a.filterTriggersByProxy(e,n)}))},e.prototype.filterTriggersByProxy=function(e,t){return this.getFilteredProxies(t).then((function(r){if(t&&"/.*/"!==t&&e){var n=r.map((function(e){return e.proxyid}));e=e.filter((function(e){for(var t=0;t<e.hosts.length;t++){var r=e.hosts[t];if(n.includes(r.proxy_hostid))return!0}return!1}))}return e}))},e.prototype.getFilteredProxies=function(e){return this.zabbixAPI.getProxies().then((function(t){return t.forEach((function(e){return e.name=e.host})),we(t,e)}))},e.prototype.getHistoryTS=function(e,t,r){var n=t[0],i=t[1];return this.enableDirectDBConnection?this.getHistoryDB(e,n,i,r).then((function(t){return N.dataResponseToTimeSeries(t,e,r)})):this.zabbixAPI.getHistory(e,n,i).then((function(t){return N.handleHistory(t,e)}))},e.prototype.getTrends=function(e,t,r){var n=t[0],i=t[1];if(this.enableDirectDBConnection)return this.getTrendsDB(e,n,i,r).then((function(t){return N.dataResponseToTimeSeries(t,e,r)}));var a=r.consolidateBy||r.valueType;return this.zabbixAPI.getTrend(e,n,i).then((function(t){return N.handleTrends(t,e,a)})).then(N.sortTimeseries)},e.prototype.getHistoryText=function(e,t,r){var n=t[0],i=t[1];return e.length?this.zabbixAPI.getHistory(e,n,i).then((function(t){return"table"===r.resultFormat?N.handleHistoryAsTable(t,e,r):N.handleText(t,e,r)})):Promise.resolve([])},e.prototype.getSLA=function(e,t,r,n){return ve(this,void 0,void 0,(function(){var i,a,s;return ge(this,(function(u){switch(u.label){case 0:return i=o.a.map(e,"serviceid"),this.supportSLA()?[4,this.zabbixAPI.getSLA60(i,t,n)]:[3,2];case 1:return a=u.sent(),[2,o.a.map(i,(function(t){var n=o.a.find(e,{serviceid:t});return N.handleSLAResponse(n,r.slaProperty,a)}))];case 2:return[4,this.zabbixAPI.getSLA(i,t,n)];case 3:return s=u.sent(),[2,o.a.map(i,(function(t){var n=o.a.find(e,{serviceid:t});return N.handleSLAResponse(n,r.slaProperty,s)}))]}}))}))},e}();function Ie(e,t){var r=p.a(t);return o.a.filter(e,(function(e){return r.test(e.name)}))}function we(e,t){return p.m(t)?Ie(e,t):function(e,t){var r=o.a.find(e,{name:t});return r?[r]:[]}(e,t)}function Ae(e,t){return p.m(t)?Ie(e,t):function(e,t){var r=o.a.filter(e,{name:t});return r||[]}(e,t)}var Se=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Pe=function(){return(Pe=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Oe=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},De=function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},Re=function(e){function t(t,r){var n=e.call(this,t)||this;n.templateSrv=r,n.isBackendTarget=function(e){return!n.enableDirectDBConnection&&(e.queryType===f.g||e.queryType===f.e)},n.isDBConnectionTarget=function(e){return n.enableDirectDBConnection&&(e.queryType===f.g||e.queryType===f.e)},n.templateSrv=r,n.enableDebugLog="development"===u.a.buildInfo.env,n.replaceTemplateVars=o.a.partial(ke,n.templateSrv),n.datasourceId=t.id,n.name=t.name,n.basicAuth=t.basicAuth,n.withCredentials=t.withCredentials;var i=m(t.jsonData);n.trends=i.trends,n.trendsFrom=i.trendsFrom||"7d",n.trendsRange=i.trendsRange||"4d";var a=i.cacheTTL||"1h";n.cacheTTL=p.q(a),n.disableReadOnlyUsersAck=i.disableReadOnlyUsersAck,n.disableDataAlignment=i.disableDataAlignment,n.enableDirectDBConnection=i.dbConnectionEnable||!1,n.dbConnectionDatasourceId=i.dbConnectionDatasourceId,n.dbConnectionDatasourceName=i.dbConnectionDatasourceName,n.dbConnectionRetentionPolicy=i.dbConnectionRetentionPolicy;var s={basicAuth:n.basicAuth,withCredentials:n.withCredentials,cacheTTL:n.cacheTTL,enableDirectDBConnection:n.enableDirectDBConnection,dbConnectionDatasourceId:n.dbConnectionDatasourceId,dbConnectionDatasourceName:n.dbConnectionDatasourceName,dbConnectionRetentionPolicy:n.dbConnectionRetentionPolicy,datasourceId:n.datasourceId};return n.zabbix=new Te(s),n}return t.$inject=["instanceSettings","templateSrv"],Se(t,e),t.prototype.query=function(e){var t=e.targets.map((function(e){return h(o.a.cloneDeep(e))})),r=this.backendQuery(Pe(Pe({},e),{targets:t})),i=this.dbConnectionQuery(Pe(Pe({},e),{targets:t})),a=this.frontendQuery(Pe(Pe({},e),{targets:t}));return Promise.all([r,i,a]).then((function(t){var r=t[0],i=t[1],a=t[2];return i.data&&(r.data=r.data.concat(i.data)),a.data&&(r.data=r.data.concat(a.data)),{data:r.data,state:n.LoadingState.Done,key:e.requestId}}))},t.prototype.backendQuery=function(e){return Oe(this,void 0,Promise,(function(){var t,r,n,a,s,u,l,c,f,h,d=this;return De(this,(function(m){switch(m.label){case 0:if(t=e.intervalMs,r=e.maxDataPoints,n=e.range,a=e.requestId,s=e.targets.filter(this.isBackendTarget),e.scopedVars=Object.assign({},e.scopedVars,p.i(e.range)),!(u=o.a.compact(s.map((function(n){return n.hide?null:(d.replaceTargetVariables(n,e),Pe(Pe({},n),{datasourceId:d.datasourceId,intervalMs:t,maxDataPoints:r}))})))).length)return[2,Promise.resolve({data:[]})];l={queries:u},n&&(l.range=n,l.from=n.from.valueOf().toString(),l.to=n.to.valueOf().toString()),m.label=1;case 1:return m.trys.push([1,3,,4]),[4,Object(i.getBackendSrv)().fetch({url:"/api/ds/query",method:"POST",data:l,requestId:a}).toPromise()];case 2:return c=m.sent(),[3,4];case 3:return f=m.sent(),[2,Object(i.toDataQueryResponse)(f)];case 4:return h=Object(i.toDataQueryResponse)(c),this.sortByRefId(h),this.applyFrontendFunctions(h,e),N.convertZabbixUnits(h),N.isConvertibleToWide(h.data)&&(console.log("Converting response to the wide format"),h.data=N.convertToWide(h.data)),[2,h]}}))}))},t.prototype.frontendQuery=function(e){return Oe(this,void 0,Promise,(function(){var t,r,i=this;return De(this,(function(a){return t=e.targets.filter((function(e){return!(i.isBackendTarget(e)||i.isDBConnectionTarget(e))})),r=o.a.map(t,(function(t){if(t.hide)return[];e.scopedVars=Object.assign({},e.scopedVars,p.i(e.range)),i.replaceTargetVariables(t,e);var r=i.buildTimeRange(e,t);return t.queryType===f.i?t.group&&t.host&&t.item?i.queryTextData(t,r):[]:t.queryType===f.f?i.queryITServiceData(t,r,e):t.queryType===f.j?i.queryTriggersData(t,r):t.queryType===f.h?i.queryProblems(t,r,e):[]})),[2,Promise.all(o.a.flatten(r)).then(o.a.flatten).then((function(e){return e&&e.length>0&&Object(n.isDataFrame)(e[0])&&!p.l(e[0])&&(e=N.alignFrames(e),N.isConvertibleToWide(e)&&(console.log("Converting response to the wide format"),e=N.convertToWide(e))),{data:e}}))]}))}))},t.prototype.dbConnectionQuery=function(e){return Oe(this,void 0,Promise,(function(){var t,r,n=this;return De(this,(function(i){return t=e.targets.filter(this.isDBConnectionTarget),r=o.a.compact(t.map((function(t){if(t.hide)return[];e.scopedVars=Object.assign({},e.scopedVars,p.i(e.range)),n.replaceTargetVariables(t,e);var r=n.buildTimeRange(e,t),i=n.isUseTrends(r);return t.queryType&&t.queryType!==f.g?t.queryType===f.e&&t.itemids?n.queryItemIdData(t,r,i,e):[]:n.queryNumericData(t,r,i,e)}))),[2,Promise.all(r).then(o.a.flatten).then((function(e){return{data:e}}))]}))}))},t.prototype.buildTimeRange=function(e,t){var r=Math.ceil(c.parse(e.range.from)/1e3),n=Math.ceil(c.parse(e.range.to)/1e3),i=_e(t.functions,"Time");if(i.length){var a=p.w(i)([r,n]);r=a[0],n=a[1]}return[r,n]},t.prototype.queryNumericData=function(e,t,r,n){return Oe(this,void 0,Promise,(function(){var i,a,o,s,u;return De(this,(function(l){switch(l.label){case 0:return i={itemtype:"num"},[4,this.zabbix.getItemsFromTarget(e,i)];case 1:return a=l.sent(),o=(new Date).getTime(),[4,this.queryNumericDataForItems(a,e,t,r,n)];case 2:return s=l.sent(),u=(new Date).getTime(),this.enableDebugLog&&console.log("Datasource::Performance Query Time ("+this.name+"): "+(u-o)),[2,this.handleBackendPostProcessingResponse(s,n,e)]}}))}))},t.prototype.queryNumericDataForItems=function(e,t,r,n,i){return Oe(this,void 0,void 0,(function(){var a,s;return De(this,(function(u){switch(u.label){case 0:return i.valueType=this.getTrendValueType(t),i.consolidateBy=function(e){var t,r=o.a.find(e.functions,(function(e){return"consolidateBy"===e.def.name}));r&&r.params&&r.params.length&&(t=r.params[0]);return t}(t)||i.valueType,n?[4,this.zabbix.getTrends(e,r,i)]:[3,2];case 1:return a=u.sent(),[3,4];case 2:return[4,this.zabbix.getHistoryTS(e,r,i)];case 3:a=u.sent(),u.label=4;case 4:return s={from:r[0],to:r[1]},[4,this.invokeDataProcessingQuery(a,t,s)];case 5:return[2,u.sent()]}}))}))},t.prototype.invokeDataProcessingQuery=function(e,t,r){return Oe(this,void 0,void 0,(function(){var n;return De(this,(function(a){switch(a.label){case 0:return n={url:"/api/datasources/"+this.datasourceId+"/resources/db-connection-post",method:"POST",headers:{"Content-Type":"application/json"},hideFromInspector:!1,data:{series:e,query:t,timeRange:r}},[4,Object(i.getBackendSrv)().fetch(n).toPromise()];case 1:return[2,a.sent().data]}}))}))},t.prototype.handleBackendPostProcessingResponse=function(e,t,r){for(var i=[],a=0,o=e;a<o.length;a++){var s=o[a],u=Object(n.dataFrameFromJSON)(s);u.refId=r.refId,i.push(u)}var l={data:i};return this.sortByRefId(l),this.applyFrontendFunctions(l,t),N.isConvertibleToWide(l.data)&&(console.log("Converting response to the wide format"),l.data=N.convertToWide(l.data)),l.data},t.prototype.getTrendValueType=function(e){var t=o.a.map(x().Trends,"name"),r=o.a.find(e.functions,(function(e){return o.a.includes(t,e.def.name)}));return r?r.params[0]:"avg"},t.prototype.sortByRefId=function(e){e.data.sort((function(e,t){return e.refId<t.refId?-1:e.refId>t.refId?1:0}))},t.prototype.applyFrontendFunctions=function(e,t){for(var r=0;r<e.data.length;r++){var n=e.data[r],i=_e(Fe(t,n.refId).functions,"Alias");p.w(i)(n)}return e},t.prototype.queryTextData=function(e,t){var r=this;return this.zabbix.getItemsFromTarget(e,{itemtype:"text"}).then((function(n){return r.zabbix.getHistoryText(n,t,e)})).then((function(t){return"table"!==e.resultFormat?t.map((function(t){return N.seriesToDataFrame(t,e,[],n.FieldType.string)})):t}))},t.prototype.queryItemIdData=function(e,t,r,n){var i=this,a=e.itemids;return a=this.templateSrv.replace(a,n.scopedVars,Le),(a=o.a.map(a.split(","),(function(e){return e.trim()})))?this.zabbix.getItemsByIDs(a).then((function(a){return i.queryNumericDataForItems(a,e,t,r,n)})):[]},t.prototype.queryITServiceData=function(e,t,r){var n;return Oe(this,void 0,void 0,(function(){var i,a,s,u,l;return De(this,(function(c){switch(c.label){case 0:return e.hide||!e.itservice&&!e.itServiceFilter||!e.slaProperty?[2,[]]:(r.isOldVersion=e.itservice&&!e.itServiceFilter,i=r.isOldVersion?"/.*/":this.replaceTemplateVars(e.itServiceFilter,r.scopedVars),r.slaInterval=e.slaInterval,[4,this.zabbix.getITServices(i)]);case 1:return a=c.sent(),r.isOldVersion&&(a=o.a.filter(a,{serviceid:null===(n=e.itservice)||void 0===n?void 0:n.serviceid})),[4,this.zabbix.getSLA(a,t,e,r)];case 2:return s=c.sent(),u=N.itServiceResponseToTimeSeries(s,e.slaInterval),[4,this.invokeDataProcessingQuery(u,e,{})];case 3:return l=c.sent(),[2,this.handleBackendPostProcessingResponse(l,r,e)]}}))}))},t.prototype.queryTriggersData=function(e,t){var r=this,n=t[0],i=t[1];return this.zabbix.getHostsFromTarget(e).then((function(a){var s=a[0],u=a[1];if(s.length){var l=o.a.map(s,"hostid"),c=o.a.map(u,"applicationid"),p={minSeverity:e.triggers.minSeverity,acknowledged:e.triggers.acknowledged,count:e.triggers.count,timeFrom:n,timeTo:i},f=e.group.filter;return Promise.all([r.zabbix.getHostAlerts(l,c,p),r.zabbix.getGroups(f)]).then((function(e){var r=e[0],n=e[1];return N.handleTriggersResponse(r,n,t)}))}return Promise.resolve([])}))},t.prototype.queryProblems=function(e,t,r){var n,i,a,s,u,c,f,h,d,m,v,g,y,b,E,x,T=t[0],I=t[1],w=l.contextSrv.isEditor||l.contextSrv.isGrafanaAdmin,A=e.showProblems||Z.a.Problems,S=e.options.hostProxy?this.zabbix.getProxies():function(){return[]};x=!this.disableReadOnlyUsersAck||w;var P=this.replaceTemplateVars(null===(n=e.group)||void 0===n?void 0:n.filter,r.scopedVars),O=this.replaceTemplateVars(null===(i=e.host)||void 0===i?void 0:i.filter,r.scopedVars),D=this.replaceTemplateVars(null===(a=e.application)||void 0===a?void 0:a.filter,r.scopedVars),R=this.replaceTemplateVars(null===(s=e.proxy)||void 0===s?void 0:s.filter,r.scopedVars),_=this.replaceTemplateVars(null===(u=e.trigger)||void 0===u?void 0:u.filter,r.scopedVars),C=this.replaceTemplateVars(null===(c=e.tags)||void 0===c?void 0:c.filter,r.scopedVars),N=Pe(Pe({},e),{trigger:{filter:_},tags:{filter:C}}),L=C.replace("/^","").replace("$/",""),k=p.t(L);k.forEach((function(e){e.operator=1}));var $,M={recent:A===Z.a.Recent,minSeverity:null===(f=e.options)||void 0===f?void 0:f.minSeverity,limit:null===(h=e.options)||void 0===h?void 0:h.limit};if(k&&k.length&&(M.tags=k),0!==(null===(d=e.options)||void 0===d?void 0:d.acknowledged)&&1!==(null===(m=e.options)||void 0===m?void 0:m.acknowledged)||(M.acknowledged=!!(null===(v=e.options)||void 0===v?void 0:v.acknowledged)),null===(g=e.options)||void 0===g?void 0:g.minSeverity){var j=[0,1,2,3,4,5].filter((function(t){var r;return t>=(null===(r=e.options)||void 0===r?void 0:r.minSeverity)}));(null===(y=e.options)||void 0===y?void 0:y.severities)&&(j=j.filter((function(t){var r;return null===(r=e.options)||void 0===r?void 0:r.severities.includes(t)}))),M.severities=j}return A===Z.a.History||(null===(b=e.options)||void 0===b?void 0:b.useTimeRange)?(M.timeFrom=T,M.timeTo=I,$=this.zabbix.getProblemsHistory(P,O,D,R,M)):$=this.zabbix.getProblems(P,O,D,R,M),Promise.all([$,S]).then((function(e){var t=e[0],r=e[1];return E=o.a.keyBy(r,"proxyid"),t})).then((function(e){return F.setMaintenanceStatus(e)})).then((function(e){return F.setAckButtonStatus(e,x)})).then((function(e){return F.filterTriggersPre(e,N)})).then((function(t){return F.sortProblems(t,e)})).then((function(t){return F.addTriggerDataSource(t,e)})).then((function(e){return F.addTriggerHostProxy(e,E)})).then((function(e){return F.toDataFrame(e)}))},t.prototype.testDatasource=function(){return Oe(this,void 0,void 0,(function(){var e,t,r,n,i;return De(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.zabbix.testDataSource()];case 1:return e=a.sent(),t=e.zabbixVersion,r=e.dbConnectorStatus,n="Zabbix API version: "+t,r&&(n+=", DB connector type: "+r.dsType),[2,{status:"success",title:"Success",message:n}];case 2:return(i=a.sent())instanceof ne?[2,{status:"error",title:i.message,message:i.message}]:i.data&&i.data.message?[2,{status:"error",title:"Zabbix Client Error",message:i.data.message}]:"string"==typeof i?[2,{status:"error",title:"Unknown Error",message:i}]:(console.log(i),[2,{status:"error",title:"Connection failed",message:"Could not connect to given url"}]);case 3:return[2]}}))}))},t.prototype.metricFindQuery=function(e,t){var r,n=o.a.cloneDeep(e);if(!e)return Promise.resolve([]);"string"==typeof e&&(n=p.s(e));for(var i=0,a=["group","host","application","itemTag","item"];i<a.length;i++){var s=a[i];n[s]=this.replaceTemplateVars(n[s],{})}var u=n.group,l=n.host,c=n.application,f=n.item;switch(n.queryType){case Z.b.Group:r=this.zabbix.getGroups(n.group);break;case Z.b.Host:r=this.zabbix.getHosts(n.group,n.host);break;case Z.b.Application:r=this.zabbix.getApps(n.group,n.host,n.application);break;case Z.b.ItemTag:r=this.zabbix.getItemTags(n.group,n.host,n.itemTag);break;case Z.b.Item:r=this.zabbix.getItems(n.group,n.host,n.application,null,n.item);break;case Z.b.ItemValues:var h=null==t?void 0:t.range;r=this.zabbix.getItemValues(u,l,c,f,{range:h});break;default:r=Promise.resolve([])}return r.then((function(e){return o.a.map(e,Ce)}))},t.prototype.targetContainsTemplate=function(e){var t,r,n,a,o,s,u,l=Object(i.getTemplateSrv)();return l.variableExists(null===(t=e.group)||void 0===t?void 0:t.filter)||l.variableExists(null===(r=e.host)||void 0===r?void 0:r.filter)||l.variableExists(null===(n=e.application)||void 0===n?void 0:n.filter)||l.variableExists(null===(a=e.itemTag)||void 0===a?void 0:a.filter)||l.variableExists(null===(o=e.item)||void 0===o?void 0:o.filter)||l.variableExists(null===(s=e.proxy)||void 0===s?void 0:s.filter)||l.variableExists(null===(u=e.trigger)||void 0===u?void 0:u.filter)||l.variableExists(e.textFilter)||l.variableExists(e.itServiceFilter)},t.prototype.annotationQuery=function(e){var t=this,r=e.range||e.rangeRaw,n=Math.ceil(c.parse(r.from)/1e3),i=Math.ceil(c.parse(r.to)/1e3),a=e.annotation,s={value:a.showOkEvents?["0","1"]:"1",valueFromEvent:!0,timeFrom:n,timeTo:i};if(a.minseverity){var u=[0,1,2,3,4,5].filter((function(e){return e>=Number(a.minseverity)}));s.severities=u}var l=this.replaceTemplateVars(a.group,{}),f=this.replaceTemplateVars(a.host,{}),h=this.replaceTemplateVars(a.application,{});return this.zabbix.getProblemsHistory(l,f,h,void 0,s).then((function(e){var r=t.replaceTemplateVars(a.trigger,{});return p.m(r)?e=o.a.filter(e,(function(e){return p.a(r).test(e.description)})):r&&(e=o.a.filter(e,(function(e){return e.description===r}))),a.hideAcknowledged&&(e=o.a.filter(e,(function(e){var t;return!(null===(t=e.acknowledges)||void 0===t?void 0:t.length)}))),o.a.map(e,(function(e){var t=p.h(e.acknowledges),r=[];return a.showHostname&&(r=o.a.map(e.hosts,"name")),{title:"1"===e.value?"Problem":"OK",time:1e3*e.timestamp,annotation:a,text:e.name+t,tags:r}}))}))},t.prototype.replaceTargetVariables=function(e,t){var r=this;o.a.forEach(["group","host","application","itemTag","item"],(function(n){e[n]&&e[n].filter&&(e[n].filter=r.replaceTemplateVars(e[n].filter,t.scopedVars))})),e.textFilter&&(e.textFilter=this.replaceTemplateVars(e.textFilter,t.scopedVars)),e.itemids&&(e.itemids=this.templateSrv.replace(e.itemids,t.scopedVars,Le)),o.a.forEach(e.functions,(function(e){e.params=o.a.map(e.params,(function(e){return"number"==typeof e?+r.templateSrv.replace(e.toString(),t.scopedVars):r.templateSrv.replace(e,t.scopedVars)}))}))},t.prototype.isUseTrends=function(e){var t=e[0],r=e[1],n=Math.ceil(c.parse("now-"+this.trendsFrom)/1e3),i=Math.ceil(p.q(this.trendsRange)/1e3);return this.trends&&(t<n||r-t>i)},t}(n.DataSourceApi);function _e(e,t){var r=o.a.map(x()[t],"name"),n=o.a.filter(e,(function(e){return o.a.includes(r,e.def.name)}));return o.a.map(n,(function(e){return E(e.def,e.params).bindFunction(w.metricFunctions)}))}function Ce(e){return{text:e.name,expandable:!1}}function Ne(e){return"string"==typeof e?p.e(e):"("+o.a.map(e,p.e).join("|")+")"}function Le(e){return"string"==typeof e?e:e.join(",")}function ke(e,t,r){var n=e.replace(t,r,Ne);return t&&t!==n&&!p.m(n)&&(n="/^"+n+"$/"),n}function Fe(e,t){for(var r=0;r<e.targets.length;r++){var n=e.targets[r];if(n.refId===t)return n}return null}var $e=r(18),Me=r(19),je=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),qe=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},Ve=function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};var Be,He,ze,Ge,Ue=function(e){function t(t,r,n){var a=e.call(this,t,r)||this;return a.getItemTags=function(){var e;if(!(null===(e=a.metric)||void 0===e?void 0:e.tagList))return[];var t=a.metric.tagList.map((function(e){return Object(p.o)(e)}));return o.a.forEach(a.templateSrv.getVariables(),(function(e){t.unshift("$"+e.name)})),t},a.zabbix=a.datasource.zabbix,a.replaceTemplateVars=a.datasource.replaceTemplateVars,a.templateSrv=Object(i.getTemplateSrv)(),a.editorModes=[{value:"num",text:"Metrics",queryType:f.g},{value:"text",text:"Text",queryType:f.i},{value:"itservice",text:"IT Services",queryType:f.f},{value:"itemid",text:"Item ID",queryType:f.e},{value:"triggers",text:"Triggers",queryType:f.j},{value:"problems",text:"Problems",queryType:f.h}],a.$scope.editorMode={METRICS:f.g,TEXT:f.i,ITSERVICE:f.f,ITEMID:f.e,TRIGGERS:f.j,PROBLEMS:f.h},a.slaPropertyList=[{name:"Status",property:"status"},{name:"SLA",property:"sla"},{name:"OK time",property:"okTime"},{name:"Problem time",property:"problemTime"},{name:"Down time",property:"downtimeTime"}],a.slaIntervals=[{text:"No interval",value:"none"},{text:"Auto",value:"auto"},{text:"1 hour",value:"1h"},{text:"12 hours",value:"12h"},{text:"24 hours",value:"1d"},{text:"1 week",value:"1w"},{text:"1 month",value:"1M"}],a.ackFilters=[{text:"all triggers",value:2},{text:"unacknowledged",value:0},{text:"acknowledged",value:1}],a.problemAckFilters=["all triggers","unacknowledged","acknowledged"],a.sortByFields=[{text:"Default",value:"default"},{text:"Last change",value:"lastchange"},{text:"Severity",value:"severity"}],a.showEventsFields=[{text:"All",value:[0,1]},{text:"OK",value:[0]},{text:"Problems",value:1}],a.showProblemsOptions=[{text:"Problems",value:"problems"},{text:"Recent problems",value:"recent"},{text:"History",value:"history"}],a.resultFormats=[{text:"Time series",value:"time_series"},{text:"Table",value:"table"}],a.severityOptions=f.l,a.getGroupNames=o.a.bind(a.getMetricNames,a,"groupList"),a.getHostNames=o.a.bind(a.getMetricNames,a,"hostList",!0),a.getApplicationNames=o.a.bind(a.getMetricNames,a,"appList"),a.getItemNames=o.a.bind(a.getMetricNames,a,"itemList"),a.getITServices=o.a.bind(a.getMetricNames,a,"itServiceList"),a.getProxyNames=o.a.bind(a.getMetricNames,a,"proxyList"),a.getVariables=o.a.bind(a.getTemplateVariables,a),n.$on("template-variable-value-updated",(function(){return a.onVariableChange()})),t.$on("typeahead-updated",(function(){a.onTargetBlur()})),a.init=function(){var e=a.target;e=h(e),a.refresh();var t={metric:{},oldTarget:o.a.cloneDeep(a.target),queryOptionsText:a.renderQueryOptionsText()};o.a.defaults(a,t);var r={queryType:f.g,group:{filter:""},host:{filter:""},application:{filter:""},itemTag:{filter:""},item:{filter:""},functions:[],triggers:{count:!0,minSeverity:3,acknowledged:2},trigger:{filter:""},tags:{filter:""},proxy:{filter:""},options:{showDisabledItems:!1,skipEmptyValues:!1,disableDataAlignment:!1,useZabbixValueMapping:!1},table:{skipEmptyValues:!1}};o.a.defaultsDeep(e,r),a.initDefaultQueryMode(e),a.panel.type===f.m&&(e.queryType=f.h,e.options.severities=function(e){if(!e)return[0,1,2,3,4,5];for(var t=[],r=0,n=e;r<n.length;r++){var i=n[r];i.show&&t.push(i.priority)}return t}(a.panel.triggerSeverity)),e.functions=o.a.map(e.functions,(function(e){return E(e.def,e.params)})),e.queryType===f.f&&o.a.defaultsDeep(e,{slaProperty:{name:"SLA",property:"sla"},slaInterval:"none"}),e.queryType===f.h&&o.a.defaultsDeep(e,{showProblems:Z.a.Problems,options:{minSeverity:0,sortProblems:"default",acknowledged:2,hostsInMaintenance:!1,hostProxy:!1,limit:f.c}}),e.queryType===f.g||e.queryType===f.i||e.queryType===f.j||e.queryType===f.h?a.initFilters():e.queryType===f.f&&a.suggestITServices()},a.panel.type===f.m&&(a.panel.schemaVersion=Me.a),a.init(),a.queryOptionsText=a.renderQueryOptionsText(),a}return t.$inject=["$scope","$injector","$rootScope"],je(t,e),t.prototype.initFilters=function(){var e=this,t=o.a.find(this.editorModes,{queryType:this.target.queryType}),r=t?t.value:null,n=[this.suggestGroups(),this.suggestHosts(),this.suggestApps()];return this.target.queryType!==f.g&&this.target.queryType!==f.i||n.push(this.suggestItems(r)),this.target.queryType===f.h&&n.push(this.suggestProxies()),Promise.all(n).then((function(){e.zabbix.isZabbix54OrHigher()&&e.suggestItemTags().then((function(){return e.$scope.$apply()}))}))},t.prototype.initDefaultQueryMode=function(e){e.queryType!==f.g&&e.queryType!==f.i&&e.queryType!==f.f&&e.queryType!==f.e&&e.queryType!==f.j&&e.queryType!==f.h&&(e.queryType=f.g)},t.prototype.getMetricNames=function(e,t){var r=o.a.uniq(o.a.map(this.metric[e],"name"));return o.a.forEach(this.templateSrv.getVariables(),(function(e){r.unshift("$"+e.name)})),t&&r.unshift("/.*/"),r},t.prototype.getTemplateVariables=function(){return o.a.map(this.templateSrv.getVariables(),(function(e){return"$"+e.name}))},t.prototype.isZabbix54OrHigher=function(){return this.zabbix.isZabbix54OrHigher()},t.prototype.suggestGroups=function(){var e=this;return this.zabbix.getAllGroups().then((function(t){return e.metric.groupList=t,t}))},t.prototype.suggestHosts=function(){var e=this,t=this.replaceTemplateVars(this.target.group.filter);return this.zabbix.getAllHosts(t).then((function(t){return e.metric.hostList=t,t}))},t.prototype.suggestApps=function(){var e=this,t=this.replaceTemplateVars(this.target.group.filter),r=this.replaceTemplateVars(this.target.host.filter);return this.zabbix.getAllApps(t,r).then((function(t){return e.metric.appList=t,t}))},t.prototype.suggestItems=function(e){var t=this;void 0===e&&(e="num");var r=this.replaceTemplateVars(this.target.group.filter),n=this.replaceTemplateVars(this.target.host.filter),i=this.replaceTemplateVars(this.target.application.filter),a=this.replaceTemplateVars(this.target.itemTag.filter),o={itemtype:e,showDisabledItems:this.target.options.showDisabledItems};return this.zabbix.getAllItems(r,n,i,a,o).then((function(e){return t.metric.itemList=e,e}))},t.prototype.suggestItemTags=function(){return qe(this,void 0,void 0,(function(){var e,t,r,n;return Ve(this,(function(i){switch(i.label){case 0:return e=this.replaceTemplateVars(this.target.group.filter),t=this.replaceTemplateVars(this.target.host.filter),[4,this.zabbix.getAllItems(e,t,null,null,{})];case 1:return r=i.sent(),n=o.a.flatten(r.map((function(e){return e.tags?e.tags:[]}))),this.metric.tagList=o.a.uniqBy(n,(function(e){return e.tag+e.value||""})),[2]}}))}))},t.prototype.suggestITServices=function(){var e=this;return this.zabbix.getITService().then((function(t){return e.metric.itServiceList=t,t}))},t.prototype.suggestProxies=function(){var e=this;return this.zabbix.getProxies().then((function(t){var r=o.a.map(t,"host");return e.metric.proxyList=r,r}))},t.prototype.isRegex=function(e){return p.m(e)},t.prototype.isVariable=function(e){return p.n(e,this.templateSrv.getVariables())},t.prototype.onTargetBlur=function(){var e=o.a.cloneDeep(this.target);o.a.isEqual(this.oldTarget,this.target)||(this.oldTarget=e,this.targetChanged())},t.prototype.onVariableChange=function(){this.isContainsVariables()&&this.targetChanged()},t.prototype.isContainsVariables=function(){var e=this;return o.a.some(["group","host","application"],(function(t){return!(!e.target[t]||!e.target[t].filter)&&p.n(e.target[t].filter,e.templateSrv.getVariables())}))},t.prototype.parseTarget=function(){},t.prototype.validateTarget=function(){},t.prototype.targetChanged=function(){this.initFilters(),this.parseTarget(),this.refresh()},t.prototype.addFunction=function(e){var t=E(e);t.added=!0,this.target.functions.push(t),this.moveAliasFuncLast(),(t.params.length&&t.added||0===t.def.params.length)&&this.targetChanged()},t.prototype.removeFunction=function(e){this.target.functions=o.a.without(this.target.functions,e),this.targetChanged()},t.prototype.moveFunction=function(e,t){var r=this.target.functions.indexOf(e);o.a.move(this.target.functions,r,r+t),this.targetChanged()},t.prototype.moveAliasFuncLast=function(){var e=o.a.find(this.target.functions,(function(e){return"Alias"===e.def.category}));e&&(this.target.functions=o.a.without(this.target.functions,e),this.target.functions.push(e))},t.prototype.toggleQueryOptions=function(){this.showQueryOptions=!this.showQueryOptions},t.prototype.onQueryOptionChange=function(){this.queryOptionsText=this.renderQueryOptionsText(),this.onTargetBlur()},t.prototype.renderQueryOptionsText=function(){var e={};this.target.queryType===f.g?e={showDisabledItems:"Show disabled items",disableDataAlignment:"Disable data alignment",useZabbixValueMapping:"Use Zabbix value mapping"}:this.target.queryType!==f.h&&this.target.queryType!==f.j||(e={sortProblems:"Sort problems",acknowledged:"Acknowledged",skipEmptyValues:"Skip empty values",hostsInMaintenance:"Show hosts in maintenance",limit:"Limit problems",hostProxy:"Show proxy",useTimeRange:"Use time range"});var t=[];return o.a.forOwn(this.target.options,(function(r,n){if(r&&e[n])if(!0===r)t.push(e[n]);else{var i=r;r&&r.text?i=r.text:r&&r.value&&(i=r.value),t.push(e[n]+" = "+i)}})),"Options: "+t.join(", ")},t.prototype.switchEditorMode=function(e){this.target.queryType=e,this.queryOptionsText=this.renderQueryOptionsText(),this.init(),this.targetChanged()},t.prototype.appFilterDisabled=function(){return!this.zabbix.supportsApplications()},t}($e.QueryCtrl),Qe=r(0),Xe=r.n(Qe),We=r(8),Ze=r(6),Ye=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},Je=function(){return(Je=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ke=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r},et=(null===(He=Ze.LegacyForms)||void 0===He?void 0:He.Input)||Ze.Input,tt=RegExp("^"+p.x.source),rt=((Be={})[Ze.EventsWithValidation.onBlur]=[{rule:function(e){return!e||!(e.length>1&&"/"===e[0]&&"/"!==e[e.length-1])},errorMessage:"Not a valid regex"},{rule:function(e){return"*"!==e},errorMessage:"Wildcards not supported. Use /.*/ instead"}],Be),nt=function(e){var t=e.value,r=(e.ref,e.validationEvents,Ke(e,["value","ref","validationEvents"])),n=function(e){return{inputRegex:Object(We.css)(ze||(ze=Ye(["\n    color: ","\n  "],["\n    color: ","\n  "])),e.palette.orange),inputVariable:Object(We.css)(Ge||(Ge=Ye(["\n    color: ","\n  "],["\n    color: ","\n  "])),e.colors.textBlue)}}(Object(Ze.useTheme)()),i=n.inputRegex;return tt.test(t)?i=n.inputVariable:Object(p.m)(t)&&(i=n.inputRegex),Xe.a.createElement(et,Je({className:i,value:t,validationEvents:rt},r))},it=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),at=function(){return(at=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ot=function(e){function t(t){var r=e.call(this,t)||this;if(r.queryTypes=[{value:Z.b.Group,label:"Group"},{value:Z.b.Host,label:"Host"},{value:Z.b.Application,label:"Application"},{value:Z.b.ItemTag,label:"Item tag"},{value:Z.b.Item,label:"Item"},{value:Z.b.ItemValues,label:"Item values"}],r.defaults={selectedQueryType:{value:Z.b.Group,label:"Group"},queryType:Z.b.Group,group:"/.*/",host:"",application:"",itemTag:"",item:""},r.handleQueryUpdate=function(e,t){var n=e.currentTarget.value;r.setState((function(e){var r=at({},e);return r[t]=n,at({},r)}))},r.handleQueryChange=function(){var e=r.state,t=e.queryType,n={queryType:t,group:e.group,host:e.host,application:e.application,itemTag:e.itemTag,item:e.item};r.props.onChange(n,"Zabbix - "+t)},r.handleQueryTypeChange=function(e){r.setState(at(at({},r.state),{selectedQueryType:e,queryType:e.value}));var t=r.state,n=t.group,i=t.host,a=t.application,o=t.itemTag,s=t.item,u=e.value,l={queryType:u,group:n,host:i,application:a,itemTag:o,item:s};r.props.onChange(l,"Zabbix - "+u)},r.props.query&&"string"==typeof r.props.query){var n=Object(p.s)(r.props.query),i=r.getSelectedQueryType(n.queryType);r.state=at({selectedQueryType:i,legacyQuery:r.props.query},n)}else if(r.props.query){n=r.props.query,i=r.getSelectedQueryType(n.queryType);r.state=at(at(at({},r.defaults),n),{selectedQueryType:i})}else r.state=r.defaults;return r}return it(t,e),t.prototype.getSelectedQueryType=function(e){return this.queryTypes.find((function(t){return t.value===e}))},t.prototype.render=function(){var e,t=this,r=this.state,n=r.selectedQueryType,i=r.legacyQuery,a=r.group,o=r.host,s=r.application,u=r.itemTag,l=r.item,c=this.props.datasource,p=(null===(e=null==c?void 0:c.zabbix)||void 0===e?void 0:e.isZabbix54OrHigher())||!1;return Xe.a.createElement(Xe.a.Fragment,null,Xe.a.createElement("div",{className:"gf-form max-width-21"},Xe.a.createElement(Ze.InlineFormLabel,{width:10},"Query Type"),Xe.a.createElement(Ze.Select,{width:11,value:n,options:this.queryTypes,onChange:this.handleQueryTypeChange})),Xe.a.createElement("div",{className:"gf-form-inline"},Xe.a.createElement("div",{className:"gf-form max-width-30"},Xe.a.createElement(Ze.InlineFormLabel,{width:10},"Group"),Xe.a.createElement(nt,{value:a,onChange:function(e){return t.handleQueryUpdate(e,"group")},onBlur:this.handleQueryChange})),n.value!==Z.b.Group&&Xe.a.createElement("div",{className:"gf-form max-width-30"},Xe.a.createElement(Ze.InlineFormLabel,{width:10},"Host"),Xe.a.createElement(nt,{value:o,onChange:function(e){return t.handleQueryUpdate(e,"host")},onBlur:this.handleQueryChange}))),(n.value===Z.b.Application||n.value===Z.b.ItemTag||n.value===Z.b.Item||n.value===Z.b.ItemValues)&&Xe.a.createElement("div",{className:"gf-form-inline"},p&&Xe.a.createElement("div",{className:"gf-form max-width-30"},Xe.a.createElement(Ze.InlineFormLabel,{width:10},"Item tag"),Xe.a.createElement(nt,{value:u,onChange:function(e){return t.handleQueryUpdate(e,"itemTag")},onBlur:this.handleQueryChange})),!p&&Xe.a.createElement("div",{className:"gf-form max-width-30"},Xe.a.createElement(Ze.InlineFormLabel,{width:10},"Application"),Xe.a.createElement(nt,{value:s,onChange:function(e){return t.handleQueryUpdate(e,"application")},onBlur:this.handleQueryChange})),(n.value===Z.b.Item||n.value===Z.b.ItemValues)&&Xe.a.createElement("div",{className:"gf-form max-width-30"},Xe.a.createElement(Ze.InlineFormLabel,{width:10},"Item"),Xe.a.createElement(nt,{value:l,onChange:function(e){return t.handleQueryUpdate(e,"item")},onBlur:this.handleQueryChange}))),i&&Xe.a.createElement("div",{className:"gf-form"},Xe.a.createElement(Ze.InlineFormLabel,{width:10,tooltip:"Original query string, read-only"},"Legacy Query"),Xe.a.createElement(Ze.Input,{css:"",value:i,readOnly:!0})))},t}(Qe.PureComponent),st=function(){return(st=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ut=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r},lt=Ze.LegacyForms.FormField,ct=Ze.LegacyForms.Switch,pt=["mysql","postgres","influxdb"],ft=function(e,t,r){return function(n){var i;r(st(st({},t),{jsonData:st(st({},t.jsonData),(i={},i[e]=n.currentTarget.value,i))}))}},ht=function(e,t,r){return function(n){var i;r(st(st({},t),{jsonData:st(st({},t.jsonData),(i={},i[e]=n.target.checked,i))}))}},dt=function(e,t,r){return function(n){var i;r(st(st({},t),{secureJsonData:st(st({},t.secureJsonData),(i={},i[e]=n.currentTarget.value,i))}))}},mt=function(e,t,r){return function(n){var i;r(st(st({},t),{secureJsonFields:st(st({},t.secureJsonFields),(i={},i[e]=!1,i))}))}},vt=function(e,t,r,n){return function(i){var a=gt().find((function(e){return e.id===i.value}));r({label:a.name,value:a.id}),n(a.type),t(st(st({},e),{jsonData:st(st({},e.jsonData),{dbConnectionDatasourceId:i.value})}))}},gt=function(){var e=Object(i.getDataSourceSrv)().getAll();return e=e.filter((function(e){return pt.includes(e.type)}))},yt=function(){return gt().map((function(e){return{label:e.name,value:e.id,description:e.type}}))},bt=r(45),Et=r.n(bt),xt=r(15),Tt=r.n(xt);Et.a.module("grafana.directives").directive("addMetricFunction",["$compile",function(e){return{link:function(t,r){var n=x(),i=function(e){return o.a.reduce(e,(function(e,t){return o.a.each(t,(function(t){e.push(t.name)})),e}),[])}(n);t.functionMenu=function(e){return o.a.map(e,(function(e,t){return{text:t,submenu:o.a.map(e,(function(e){return{text:e.name,click:"ctrl.addFunction('"+e.name+"')"}}))}}))}(n);var a=Tt()('<input type="text" class="gf-form-input" spellcheck="false" style="display:none"></input>'),s=Tt()('<a  class="gf-form-label tight-form-func dropdown-toggle query-part" tabindex="1" gf-dropdown="functionMenu" data-toggle="dropdown"><i class="fa fa-plus"></i></a>');a.appendTo(r),s.appendTo(r),a.attr("data-provide","typeahead"),a.typeahead({source:i,minLength:1,items:10,updater:function(e){var r=function(e){return v[e]}(e);if(r||(e=e.toLowerCase(),r=o.a.find(i,(function(t){return 0===t.toLowerCase().indexOf(e)}))))return t.$apply((function(){t.ctrl.addFunction(r)})),a.trigger("blur"),""}}),s.click((function(){s.hide(),a.show(),a.focus()})),a.keyup((function(){r.toggleClass("open",""===a.val())})),a.blur((function(){setTimeout((function(){a.val(""),a.hide(),s.show(),r.removeClass("open")}),200)})),e(r.contents())(t)}}}]);var It=r(31),wt=r.n(It);var At=function(e){return e.description?Xe.a.createElement("span",{className:"pointer fa fa-question-circle",onClick:e.onDescriptionShow}):Xe.a.createElement("span",{className:"pointer fa fa-question-circle",onClick:function(){window.open("https://alexanderzobnin.github.io/grafana-zabbix/reference/functions/#"+e.name,"_blank")}})},St=function(e){var t=e.func,r=e.onMoveLeft,n=e.onMoveRight,i=e.onRemove,a=e.onDescriptionShow;return Xe.a.createElement("div",{style:{display:"flex",width:"60px",justifyContent:"space-between"}},Xe.a.createElement("span",{className:"pointer fa fa-arrow-left",onClick:function(){return r(t)}}),Xe.a.createElement(At,{name:t.def.name,description:t.def.description,onDescriptionShow:a}),Xe.a.createElement("span",{className:"pointer fa fa-remove",onClick:function(){return i(t)}}),Xe.a.createElement("span",{className:"pointer fa fa-arrow-right",onClick:function(){return n(t)}}))},Pt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ot=function(){return(Ot=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Dt=function(e){function t(t){var r=e.call(this,t)||this;return r.triggerRef=Xe.a.createRef(),r.renderContent=function(e){var t=e.updatePopperPosition,n=r.props,i=n.onMoveLeft,a=n.onMoveRight,o=n.func.def,s=o.name,u=o.description;return r.state.showingDescription?Xe.a.createElement("div",{style:{overflow:"auto",maxHeight:"30rem",textAlign:"left",fontWeight:"normal"}},Xe.a.createElement("h4",{style:{color:"white"}}," ",s," "),Xe.a.createElement("div",null,u)):Xe.a.createElement(St,Ot({},r.props,{onMoveLeft:function(){i(r.props.func),t()},onMoveRight:function(){a(r.props.func),t()},onDescriptionShow:function(){r.setState({showingDescription:!0},(function(){t()}))}}))},r.state={showingDescription:!1},r}return Pt(t,e),t.prototype.render=function(){var e=this;return Xe.a.createElement(Ze.PopoverController,{content:this.renderContent,placement:"top",hideAfter:300},(function(t,r,n){return Xe.a.createElement(Xe.a.Fragment,null,e.triggerRef&&Xe.a.createElement(Ze.Popover,Ot({},n,{referenceElement:e.triggerRef.current,wrapperClassName:"popper",className:"popper__background",onMouseLeave:function(){e.setState({showingDescription:!1}),r()},onMouseEnter:t,renderArrow:function(e){var t=e.arrowProps,r=e.placement;return Xe.a.createElement("div",Ot({className:"popper__arrow","data-placement":r},t))}})),Xe.a.createElement("span",{ref:e.triggerRef,onClick:n.show?r:t,onMouseLeave:function(){r(),e.setState({showingDescription:!1})},style:{cursor:"pointer"}},e.props.func.def.name))}))},t}(Xe.a.PureComponent);function Rt(e,t){return{restrict:"A",link:function(r,n){var i=Tt()('\n    <zbx-function-editor\n      func="func"\n      onRemove="ctrl.handleRemoveFunction"\n      onMoveLeft="ctrl.handleMoveLeft"\n      onMoveRight="ctrl.handleMoveRight">\n    </zbx-function-editor>\n    <span>(</span>\n  '),a=r.ctrl,s=r.func,u=!1,l=0,c=null;function p(e){var t=Tt()(this),r=t.prev(".comma"),n=t.next();n.val(s.params[e]),r.removeClass("query-part__last"),t.hide(),n.show(),n.focus(),n.select();var i=n.data("typeahead");i&&(n.val(""),i.lookup())}function f(e){return e<s.def.params.length?s.def.params[e]:o.a.last(s.def.params).multiple?o.a.assign({},o.a.last(s.def.params),{optional:!0}):{}}function h(e,n){var i=Tt()(e);clearTimeout(c),c=null;var o=i.prev(),p=o.prev(".comma"),h=i.val();(""!==h||f(n).optional)&&(s.updateParam(h,n),o.html(h?t.highlightVariablesAsHtml(h):"&nbsp;")),l!==s.params.length&&(u||(u=!0,setTimeout((function(){y(),u=!1}),200))),r.$apply((function(){a.targetChanged()})),o.hasClass("query-part__last")&&""===h?p.addClass("query-part__last"):o.removeClass("query-part__last"),i.hide(),o.show()}function d(e){var t=this;c=setTimeout((function(){h(t,e)}),200)}function m(e,t){13===t.which&&Tt()(this).blur()}function v(){this.style.width=8*(3+this.value.length)+"px"}function g(){i.appendTo(n);for(var a=o.a.clone(s.def.params),u=o.a.last(s.def.params);s.params.length>=a.length&&u&&u.multiple;)a.push(o.a.assign({},u,{optional:!0}));o.a.each(a,(function(e,r){if(e.optional&&s.params.length<r)return!1;var i=t.highlightVariablesAsHtml(s.params[r]),a=null!=i,u=r>=s.params.length-1&&e.optional&&!a;u&&e.multiple&&(i="+"),r>0&&Tt()('<span class="comma'+(u?" query-part__last":"")+'">,&nbsp; </span>').appendTo(n);var c=Tt()('<a ng-click="" class="graphite-func-param-link'+(u?" query-part__last":"")+'">'+(a?i:"&nbsp;")+"</a>"),g=Tt()('<input type="text" style="display:none" class="input-small tight-form-func-param"></input>');return g.attr("placeholder",e.name),l++,c.appendTo(n),g.appendTo(n),g.blur(o.a.partial(d,r)),g.keyup(v),g.keypress(o.a.partial(m,r)),c.click(o.a.partial(p,r)),e.options&&function(e,t){e.attr("data-provide","typeahead");var r=f(t).options;"int"!==f(t).type&&"float"!==f(t).type||(r=o.a.map(r,(function(e){return e.toString()}))),e.typeahead({source:r,minLength:0,items:20,updater:function(r){return e.val(r),h(e[0],t),r}}),e.data("typeahead").lookup=function(){return this.query=this.$element.val()||"",this.process(this.source)}}(g,r),!0})),Tt()("<span>)</span>").appendTo(n),e(n.contents())(r)}function y(){n.children().remove(),g(),r.func.added&&(r.func.added=!1,setTimeout((function(){n.find(".graphite-func-param-link").first().click()}),10))}a.handleRemoveFunction=function(e){a.removeFunction(e)},a.handleMoveLeft=function(e){a.moveFunction(e,-1)},a.handleMoveRight=function(e){a.moveFunction(e,1)},y()}}}Rt.$inject=["$compile","templateSrv"],wt.a.directive("zabbixFunctionEditor",Rt),function(e,t,r){wt.a.directive(e,["reactDirective",function(e){return e(t,r)}])}("zbxFunctionEditor",Dt,["func","onRemove","onMoveLeft","onMoveRight"]),r.d(t,"plugin",(function(){return Ct}));var _t=function(){function e(){}return e.templateUrl="datasource-zabbix/partials/annotations.editor.html",e}();Ue.templateUrl="datasource-zabbix/partials/query.editor.html",Object(i.loadPluginCss)({dark:"plugins/alexanderzobnin-zabbix-app/css/grafana-zabbix.dark.css",light:"plugins/alexanderzobnin-zabbix-app/css/grafana-zabbix.light.css"});var Ct=new n.DataSourcePlugin(Re).setConfigEditor((function(e){var t,r,n=e.options,a=e.onOptionsChange,o=Object(Qe.useState)(null),s=o[0],u=o[1],l=Object(Qe.useState)(""),c=l[0],p=l[1];return Object(Qe.useEffect)((function(){var e=n.jsonData,t=n.secureJsonFields,r=e.password,o=ut(e,["password"]);if((null==t?void 0:t.password)||(n.secureJsonData||(n.secureJsonData={}),n.secureJsonData.password=r),a(st(st({},n),{jsonData:st({trends:!0,trendsFrom:"",trendsRange:"",cacheTTL:"",timeout:void 0,disableDataAlignment:!1},o)})),n.jsonData.dbConnectionEnable)if(n.jsonData.dbConnectionDatasourceId){var s=gt().find((function(e){return e.id===n.jsonData.dbConnectionDatasourceId}));u({label:s.name,value:s.id}),p(s.type)}else{var l=n.jsonData.dbConnectionDatasourceName;Object(i.getDataSourceSrv)().get(l).then((function(e){if(e){var t=gt().find((function(t){return t.id===e.id}));u({label:t.name,value:t.id}),p(t.type),a(st(st({},n),{jsonData:st(st({},n.jsonData),{dbConnectionDatasourceId:e.id})}))}}))}}),[]),Xe.a.createElement(Xe.a.Fragment,null,Xe.a.createElement(Ze.DataSourceHttpSettings,{defaultUrl:"http://localhost/zabbix/api_jsonrpc.php",dataSourceConfig:n,showAccessOptions:!0,onChange:a}),Xe.a.createElement("div",{className:"gf-form-group"},Xe.a.createElement("h3",{className:"page-heading"},"Zabbix API details"),Xe.a.createElement("div",{className:"gf-form max-width-25"},Xe.a.createElement(lt,{labelWidth:7,inputWidth:15,label:"Username",value:n.jsonData.username||"",onChange:ft("username",n,a),required:!0})),Xe.a.createElement("div",{className:"gf-form max-width-25"},(null===(t=n.secureJsonFields)||void 0===t?void 0:t.password)?Xe.a.createElement(Xe.a.Fragment,null,Xe.a.createElement(lt,{labelWidth:7,inputWidth:15,label:"Password",disabled:!0,value:"",placeholder:"Configured"}),Xe.a.createElement(Ze.Button,{onClick:mt("password",n,a)},"Reset")):Xe.a.createElement(lt,{labelWidth:7,inputWidth:15,label:"Password",type:"password",value:(null===(r=n.secureJsonData)||void 0===r?void 0:r.password)||n.jsonData.password||"",onChange:dt("password",n,a),required:!0})),Xe.a.createElement(ct,{label:"Trends",labelClass:"width-7",checked:n.jsonData.trends,onChange:ht("trends",n,a)}),n.jsonData.trends&&Xe.a.createElement(Xe.a.Fragment,null,Xe.a.createElement("div",{className:"gf-form"},Xe.a.createElement(lt,{labelWidth:7,inputWidth:4,label:"After",value:n.jsonData.trendsFrom||"",placeholder:"7d",onChange:ft("trendsFrom",n,a),tooltip:"Time after which trends will be used.\n                  Best practice is to set this value to your history storage period (7d, 30d, etc)."})),Xe.a.createElement("div",{className:"gf-form"},Xe.a.createElement(lt,{labelWidth:7,inputWidth:4,label:"Range",value:n.jsonData.trendsRange||"",placeholder:"4d",onChange:ft("trendsRange",n,a),tooltip:"Time range width after which trends will be used instead of history.\n                  It's better to set this value in range of 4 to 7 days to prevent loading large amount of history data."}))),Xe.a.createElement("div",{className:"gf-form"},Xe.a.createElement(lt,{labelWidth:7,inputWidth:4,label:"Cache TTL",value:n.jsonData.cacheTTL||"",placeholder:"1h",onChange:ft("cacheTTL",n,a),tooltip:"Zabbix data source caches metric names in memory. Specify how often data will be updated."})),Xe.a.createElement("div",{className:"gf-form"},Xe.a.createElement(lt,{labelWidth:7,inputWidth:4,type:"number",label:"Timeout",value:n.jsonData.timeout,onChange:function(e){a(st(st({},n),{jsonData:st(st({},n.jsonData),{timeout:parseInt(e.currentTarget.value,10)})}))},tooltip:"Zabbix API connection timeout in seconds. Default is 30."}))),Xe.a.createElement("div",{className:"gf-form-group"},Xe.a.createElement("h3",{className:"page-heading"},"Direct DB Connection"),Xe.a.createElement(ct,{label:"Enable",labelClass:"width-9",checked:n.jsonData.dbConnectionEnable,onChange:ht("dbConnectionEnable",n,a)}),n.jsonData.dbConnectionEnable&&Xe.a.createElement(Xe.a.Fragment,null,Xe.a.createElement("div",{className:"gf-form"},Xe.a.createElement(Ze.InlineFormLabel,{width:9},"Data Source"),Xe.a.createElement(Ze.Select,{width:32,options:yt(),value:s,onChange:vt(n,a,u,p)})),"influxdb"===c&&Xe.a.createElement("div",{className:"gf-form"},Xe.a.createElement(lt,{labelWidth:9,inputWidth:16,label:"Retention Policy",value:n.jsonData.dbConnectionRetentionPolicy||"",placeholder:"Retention policy name",onChange:ft("dbConnectionRetentionPolicy",n,a),tooltip:"Specify retention policy name for fetching long-term stored data (optional).\n                    Leave it blank if only default retention policy used."})))),Xe.a.createElement("div",{className:"gf-form-group"},Xe.a.createElement("h3",{className:"page-heading"},"Other"),Xe.a.createElement(ct,{label:"Disable acknowledges for read-only users",labelClass:"width-16",checked:n.jsonData.disableReadOnlyUsersAck,onChange:ht("disableReadOnlyUsersAck",n,a)}),Xe.a.createElement(ct,{label:"Disable data alignment",labelClass:"width-16",checked:!!n.jsonData.disableDataAlignment,onChange:ht("disableDataAlignment",n,a),tooltip:"Data alignment feature aligns points based on item update interval.\n            For instance, if value collected once per minute, then timestamp of the each point will be set to the start of corresponding minute.\n            This alignment required for proper work of the stacked graphs.\n            If you don't need stacked graphs and want to get exactly the same timestamps as in Zabbix, then you can disable this feature."})))})).setQueryCtrl(Ue).setAnnotationQueryCtrl(_t).setVariableQueryEditor(ot)}])}));
//# sourceMappingURL=module.js.map